<!DOCTYPE html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://use.typekit.net/ilp4lxb.css">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Consent Integration | Guides | Tealium Docs</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="generator" content="Hugo 0.111.3">
    
    <meta NAME="ROBOTS" CONTENT="INDEX, FOLLOW">
    
    
    <link rel="alternate" hreflang="ja" href="https://docs.tealium.com/ja/guides/supported-consent-integration/">
    <link href='/dist/css/app.css' rel='stylesheet' type="text/css" />
    <script>
      history.scrollRestoration = "manual";
      if (location.hash) {
        window.scrollTo(0, 0);
        setTimeout(function() {
          window.scrollTo(0, 0);
        }, 10);
      }
    </script>
  </head>
  <body class="sidebar ma0 sans-serif text-color-primary  hg-page">
    <script>
    var utag_data = {
        site_section  : "guides",
        reading_time  : "8",
        site_language : "en",
        tealium_event : "page_view"
    }
    </script>

    <script>
     (function(a,b,c,d){
        a="//tags.tiqcdn.com/utag/tealium/docs/prod/utag.js";
        b=document;c='script';d=b.createElement(c);d.src=a;d.type='text/java'+c;d.async=true;
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a);
      })();
    </script>
<nav class="w-100 sticky-t bg-primary-color-light bb b--light-gray dpn" role="navigation">
  <div class="flex-ns flex-wrap items-center justify-start mw9">
    <div class="lh-solid ml0-ns mr0 mr4-l mv3 pl15 dib db-ns">
      <a href="/"><img src="/images/icons/tealium-documentation-logo-color.svg" class="v-mid dib" width="186" height="31"></a>
    </div>
    
    <div class="dib ml3 mr4 mv3 pl15"><div id="docsearch">
</div>
</div><ul class="list ma0 pa0 dn dib-ns">
      <li class="f5 dib mr4">
         <a href="/help/" class="dim link mid-gray">Help</a>
      </li>
        
      <li class="f5 dib mr4">
      
        
      
        
          <a href="/ja/guides/supported-consent-integration/" class="dim link mid-gray">日本語</a>
        
      
      </li>
            
    </ul>
  </div>
</nav>
    
    <main role="main" class="content-with-sidebar pb0-ns">
      

<div class="w-100 pr4">
<div class="flex">

    
      <div id="menu" class="order-0 w-auto max-vh-100 overflow-hidden overflow-y-scroll dn db-ns sticky-l pt3 pl125" style="width:280px;">
<nav class="side-nav f6" role="navigation">
  <ul class="list pa0 mt0 mb1">
  
    <li class="w-100 fw4 f5 text-color-primary pv1 pl2"><a href="/" class="w-100 link text-color-primary hover-primary-color pv2 pl0 pr2"><img src="/images/icons/icon-arrow.svg" height="10" width="16" class="di v-mid pr1"/>Home</a></li>
  
  </ul>
  <ul class="list pa0" data-nav-section="guides"><li data-level="1" class="relative w-100 fw8 f4 mv2 text-color-primary pv1 ind2"><a href="/guides/" class="dib w-100 link text-color-primary hover-primary-color mb2"><span class="pb2">Guides</span></a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/abandonment-strategy/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".">Abandonment strategy</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/browse-abandonment-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".browse-abandonment-guide">Browse abandonment</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/cart-abandonment-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".">Cart abandonment</a></li><li data-level="1" class="selected relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/supported-consent-integration/" class="db link pr2 pv2  bg-secondary primary-color " data-target=".">Consent Integration</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/customer-spending-levels-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".customer-spending-levels-guide">Customer spending levels</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/discount-shopper-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".discount-shopper-guide">Discount shopper</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/exclude-offline-purchasers/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".exclude-offline-purchasers">Exclude offline purchasers</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/lifetime-value/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".">Lifetime value</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/user-identifier-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".user-identifier-guide">User identifiers</a></li><li data-level="1" class="relative w-100 hover-accent-color-light fw4 f5  ind2">
        <a href="/guides/vip-badge-guide/" class="db link pr2 pv2  text-color-primary hover-primary-color " data-target=".">VIP badge</a></li></ul>
</nav>
</div>
    

    <article id="main-content" class="order-1 overflow-auto vh-100 max-vh-100 pt4 ph4 mid-gray mt0-ns w-100" style="flex:1;scroll-padding-top:96px;">
      <div class="documentation-copy ph4">
        <header class="flex-none w-100"><nav id="breadcrumb">
<ul class="nav">

    
    
  
  <li class="mr1 f7 lvl0"><a class="f6 mb0 link mid-gray dim mr1" href="/">Home</a>&nbsp;>&nbsp;</li>
  

  
  
  <li class="mr1 f7 lvl1"><a class="f6 mb0 link mid-gray dim mr1" href="/guides/">Guides</a></li>
  

  
  

</ul>
</nav>

<h1 class="lh-title mt30 mb3">Consent Integration</h1>
</header>

<div class="mv2 mid-gray fn w-100">
  

  
    <p class="f4 fw3 lh-copy">
      This guide describes how to set up a supported vendor integration with Tealium iQ tag management system and verify your set up so that tags fire only when users have given their consent.
    </p>
  
</div>

<div class="prose nested-links" id="prose">
  <p>In this guide, we use OneTrust consent integration with Tealium iQ tag management system, but this setup can be applied to any of the <a href="/iq-tag-management/consent/consent-integrations/supported-vendors/">supported vendor integrations</a>. By the end of this guide, you’ll have successfully integrated OneTrust or any other supported Consent Management Platform (CMP) of your choice and the relevant enforcements in Tealium iQ to ensure your tags respect user preferences.</p>
<figure><a class="slb" href="/images/guides/consent-integration-guide.png"><img src="/images/guides/consent-integration-guide.png"
         alt="Consent integration screenshot"
         title="Consent integration screenshot"/>
    </a>
</figure>
<p>Complete the following steps to set up OneTrust Consent Integration in Tealium iQ:</p>
<ol>
<li><a href="#load-the-cmp-script">Load the CMP script</a></li>
<li><a href="#step-1-configure-the-integration">Configure the integration</a></li>
<li><a href="#step-2-set-enforcement-rules">Set enforcement rules</a></li>
<li><a href="#step-3-select-publish-location">Select publish location</a></li>
<li><a href="#step-4-create-a-purpose-group">Create a purpose group</a></li>
<li><a href="#step-5-edit-purpose-group">Edit purpose group</a></li>
<li><a href="#step-4-assign-tealium-iq-to-a-purpose">Assign Tealium iQ to a purpose</a></li>
<li><a href="#step-4-map-tags-to-purposes">Map tags to purposes</a></li>
<li><a href="#step-4-publish-the-configuration">Publish the configuration</a></li>
</ol>
<p>Additionally, we&rsquo;ll verify and troubleshoot our setup with the following steps:</p>
<ol>
<li><a href="#check-the-data-layer">Check the data layer</a></li>
<li><a href="#verify-your-consent-integration-setup-from-the-browser-console">Verify your Consent Integration setup from the browser console</a></li>
<li><a href="#use-the-debug-mode-to-view-additional-information">Use the debug mode to view additional information</a></li>
</ol>
<h2 id="requirements">Requirements</h2>
<p>Creating a consent integration requires the following:</p>
<ul>
<li>Tealium iQ Tag Management</li>
<li>Tealium Consent Integrations</li>
</ul>
<p>To set up your integration, you’ll need the following vendor-specific information:</p>
<ul>
<li>Vendor ID: Used by consent integrations to identify the CMP on the page.</li>
<li>Configured consent categories: Consent integrations refers to each of these as a purpose, and a collection of purposes from one CMP is called a purpose group.</li>
</ul>
<p>You can retrieve this information directly from the web page after accepting all tracking. For more details on how to obtain it, refer to <a href="/iq-tag-management/consent/consent-integrations/supported-vendors/#how-it-works">supported vendor integrations</a>.</p>
<h2 id="load-the-cmp-script">Load the CMP script</h2>
<p>To begin, we’ll inject the OneTrust CMP script into the website using either a <strong>Pre Loader</strong> or <strong>DOM Ready</strong> extension. For this setup, you’ll need your configured CMP script, which you can obtain from your CMP provider. In this example, we’ll use a OneTrust CMP script retrieved from the OneTrust console.</p>
<ol>
<li>Go to <strong>iQ Tag Management &gt; Extensions</strong>.</li>
<li>Click <strong>+ Add Extension &gt; Advanced</strong>.</li>
<li>Add a <strong>Javascript Code</strong> extension.</li>
<li>Enter a <strong>Title</strong> to identify the extension.</li>
<li>Under <strong>Scope</strong>, select <strong>Pre Loader</strong> or <strong>DOM Ready Extensions</strong>.</li>
<li>Under <strong>Configuration</strong>, paste the OneTrust CMP script:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span>window.<span style="color:#a6e22e">addCmp</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span> () {
</span></span><span style="display:flex;"><span>(<span style="color:#66d9ef">function</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">domainId</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;018dd272-a3f7-79cb-bf7a-b78b47dacb46-test&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">head</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementsByTagName</span>(<span style="color:#e6db74">&#39;head&#39;</span>)[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">script</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">createElement</span>(<span style="color:#e6db74">&#39;script&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">type</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;text/javascript&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">src</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;https://cdn.cookielaw.org/scripttemplates/otSDKStub.js&#39;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">script</span>.<span style="color:#a6e22e">setAttribute</span>(<span style="color:#e6db74">&#34;data-domain-script&#34;</span>, <span style="color:#a6e22e">domainId</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//script.setAttribute(&#34;data-domain-script&#34;, b[&#39;OTDomainGUID&#39;]);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">script</span>.<span style="color:#66d9ef">async</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">head</span>.<span style="color:#a6e22e">appendChild</span>(<span style="color:#a6e22e">script</span>);    
</span></span><span style="display:flex;"><span>})();  
</span></span></code></pre></div></li>
</ol>
<p>Next, we’ll configure the integration to ensure tags fire only based on the consent users provide.</p>
<h2 id="configure-onetrust-consent-integration-in-tealium-iq">Configure OneTrust Consent Integration in Tealium iQ</h2>
<h3 id="step-1-configure-the-integration">Step 1: Configure the integration</h3>
<ol>
<li>Go to the <strong>iQ Tag Management &gt; Consent Integrations</strong> section.</li>
<li>Click <strong>Add Integration</strong>.</li>
<li>Enter a name for the integration that clearly identifies its purpose.</li>
<li>Select <strong>OneTrust</strong> from the vendor drop-down list.</li>
<li>Enter the <strong>Vendor ID</strong> obtained from the OneTrust console.</li>
<li>To automatically create standard purposes from OneTrust, select <strong>Create new Purpose Group with OneTrust Default Categories</strong>.</li>
<li>Click <strong>Next</strong>.</li>
</ol>
<h3 id="step-2-set-enforcement-rules">Step 2: Set enforcement rules</h3>
<p><strong>Enforcement Rules</strong> determine when the consent signals captured by your CMP should be enforced. To make sure that consent is always enforced correctly, each page view or event on your website should trigger only one consent integration or exemption with no overlaps.</p>
<ol>
<li>Select <strong>All Pages and Events</strong> from the drop-down list because we&rsquo;re configuring only a single integration.</li>
<li>Click <strong>Next</strong>.</li>
</ol>
<h3 id="step-3-select-publish-location">Step 3: Select publish location</h3>
<p>The <strong>Publish Location</strong> screen allows you to choose the environments where the integration will be applied. We recommend publishing to a test environment first before going live. For this example, we’ll publish to all environments.</p>
<ol>
<li>Select the <strong>Dev, QA</strong>, and <strong>Prod</strong> environments.</li>
<li>Click <strong>Next</strong>.</li>
</ol>
<h3 id="step-4-select-purpose-group">Step 4: Select purpose group</h3>
<ol>
<li>On the <strong>Purpose Group</strong> screen, select <strong>OneTrust Default</strong> from the drop-down list.</li>
<li>Click <strong>Save</strong> to save your consent integration.</li>
</ol>
<h3 id="step-5-edit-purpose-group">Step 5: Edit purpose group</h3>
<p>After saving your consent integration, you’ll need to edit your purpose group to assign Tealium iQ to a purpose and map tags to purposes.</p>
<p>To edit purpose group:</p>
<ol>
<li>In the <strong>Consent Integrations</strong> screen, click the <strong>Purpose Groups</strong> tab.</li>
<li>Select the <strong>OneTrust Default</strong> purpose group created in <a href="#step-1-configure-the-integration">step 1</a>.</li>
</ol>
<h3 id="step-6-assign-tealium-iq-to-a-purpose">Step 6: Assign Tealium iQ to a purpose</h3>
<p>The <strong>Tealium iQ Purpose</strong> screen lets you to map Tealium iQ to a specific purpose, which is critical for managing all tag operations. If consent is required and the user does not consent to that purpose, Tealium iQ will not load, and as a result, no tags will function.</p>
<ol>
<li>Click the <strong>Tealium iQ Purpose</strong> tab.</li>
<li>To ensure Tealium iQ always loads, we’ll assign Tealium iQ to the <strong>Strictly Necessary</strong> purpose so that users cannot opt out.</li>
</ol>
<h3 id="step-7-map-tags-to-purposes">Step 7: Map tags to purposes</h3>
<p>The <strong>Map Tags</strong> screen lets you to assign tags to specific purposes, ensuring that the correct tags fire based on the user&rsquo;s consent choices. It’s important to assign a purpose to every tag, as tags without a purpose will not fire. In this screen, you can also configure tag refiring, which enables a tag to refire if the user&rsquo;s consent is updated within the same event.</p>
<ol>
<li>Click the <strong>Map Tags</strong> tab.</li>
<li>Assign each tag to an appropriate purpose.</li>
<li>Enable tag refiring if you want tags, such as the Tealium Collect tag, to refire when consent is updated in the same event.</li>
<li>Click <strong>Save</strong> to save the purpose groups.</li>
</ol>
<h3 id="step-8-publish-the-configuration">Step 8: Publish the configuration</h3>
<p>Save and publish the Tealium iQ profile to begin using the consent integration with your CMP.</p>
<p>You have now successfully configured the OneTrust integration within Tealium iQ. This setup ensures that your tags fire only when user consent is granted on all pages and events, in line with the configurations you’ve set up in your CMP. Ensure that the integration is working correctly by testing it in your chosen environment. For more information about how to test, see testing and troubleshooting below.</p>
<h2 id="test-and-troubleshoot">Test and troubleshoot</h2>
<p>Now that we&rsquo;ve configured the consent integration, let&rsquo;s make sure it&rsquo;s working. In this section, we’ll validate that the OneTrust Consent Integration in Tealium iQ is functioning correctly. We&rsquo;ll check the data layer for the consent state and use the browser console to validate our setup.</p>
<p>Before you begin, ensure that:</p>
<ul>
<li>Tealium iQ and OneTrust Consent Integration are up and running on your website.</li>
<li>You have access to the browser&rsquo;s developer console.</li>
</ul>
<h3 id="check-the-data-layer">Check the data layer</h3>
<p>The consent state is added to the data layer right before tags are fired. To ensure that the consent state is loaded properly, check for Tealium consent variables with the <code>tci</code> prefix:</p>
<ul>
<li><code>tci.consent_type</code>: Identifies the consent type (implicit or explicit).</li>
<li><code>tci.purposes_with_consent_all</code>: Contains an array with all consented purposes.</li>
<li><code>tci.purposes_with_consent_unprocessed</code>: Contains all unprocessed consented purposes.</li>
<li><code>tci.purposes_with_consent_processed</code>: Contains all processed consented purposes.</li>
</ul>
<p>The unprocessed and processed variables can be used to build logic to ensure EventStream and AudienceStream connectors don&rsquo;t fire multiple times for the same event.</p>
<h3 id="verify-your-consent-integration-setup">Verify your Consent Integration setup</h3>
<p>After Consent integrations are active, you can access the current Consent Integration details directly from the browser console. A set of <a href="/iq-tag-management/consent/consent-integrations/custom-cmp/#integration-functions">functions</a> are available within the <code>tealiumCmpIntegration</code> window-scoped object for managing and interacting with the integration.</p>
<p>To retrieve the relevant information from the web page follow these steps:</p>
<ol>
<li>
<p>Visit your website, where the CMP is implemented.</p>
</li>
<li>
<p>Accept all tracking.</p>
</li>
<li>
<p>Open the Developer Tools JavaScript console.</p>
</li>
<li>
<p>Paste the following snippet into your browser console.</p>
<pre tabindex="0"><code>var outputString = `${tealiumCmpIntegration.cmpName} - ${tealiumCmpIntegration.cmpCheckIfOptInModel() ? &#39;Opt-in&#39; : &#39;Opt-out&#39;} Model

Checks:
- vendor id:            ${tealiumCmpIntegration.cmpFetchCurrentLookupKey()}
- well-formed decision: ${tealiumCmpIntegration.cmpCheckForWellFormedDecision(tealiumCmpIntegration.cmpFetchCurrentConsentDecision())}
- explicit decision:    ${tealiumCmpIntegration.cmpCheckForExplicitConsentDecision(tealiumCmpIntegration.cmpFetchCurrentConsentDecision())}
- consented purposes:   ${JSON.stringify(tealiumCmpIntegration.cmpConvertResponseToGroupList(tealiumCmpIntegration.cmpFetchCurrentConsentDecision()).sort(),null, 8)}
`
console.log(outputString)
</code></pre></li>
</ol>
<h4 id="analyze-the-script-output">Analyze the script output</h4>
<ul>
<li>
<p><strong>Before Consent</strong>:</p>
<p>Here&rsquo;s an example of the script output before consent is granted.</p>
<figure><a class="slb" href="/images/guides/consent-integration-before-consent.png"><img src="/images/guides/consent-integration-before-consent.png"
             alt="CMP before consent screenshot"
             title="CMP before consent screenshot"/>
        </a>
    </figure>
<p>As shown, the CMP has been detected with its operating mode. In this case, explicit consent from the user has not been provided, so only <code>C0001</code> (Necessary) purpose is permitted.</p>
</li>
<li>
<p><strong>After Consent</strong>:</p>
<p>Now, let’s consent to some categories. After reloading the page, you can see the CMP and its operating mode again. This time, explicit consent has been granted, but only <code>C0001</code> (Necessary) and <code>C0002</code> (Performance) purposes are permitted.</p>
<figure><a class="slb" href="/images/guides/consent-integration-after-consent.png"><img src="/images/guides/consent-integration-after-consent.png"
             alt="CMP after consent screenshot"
             title="CMP after consent screenshot"/>
        </a>
    </figure>
</li>
</ul>
<h3 id="use-the-debug-mode-to-view-additional-information">Use the debug mode to view additional information</h3>
<p>Consent integrations also adds additional information to the Tealium <a href="/platforms/javascript/debugging/">debug mode</a>.</p>
<ol>
<li>Enable the <a href="/platforms/javascript/debugging/">debug mode</a> to view additional consent integration information.</li>
<li>To make it easier to find the consent integration information in the debug mode output, filter the output using the regular expression <code>/SENDING|****/</code> to only show tag send and Consent Integration notifications.</li>
</ol>
<p>Using the debug mode filter isolates critical consent-related messages, enabling you to:</p>
<ul>
<li>Quickly verify tag behavior based on consent choices: The filter highlights which tags are sent or blocked according to user consent, ensuring your setup respects user preferences.</li>
<li>Easily identify potential configuration issues: By focusing on relevant log entries, the filter helps spot problems like missing purpose mappings or unintended tag blocking, so you can resolve them more efficiently.</li>
</ul>
<p>Here are a few scenarios you might encounter with the debug mode filter.</p>
<h4 id="scenario-1-blocking-the-cmp-script">Scenario 1: Blocking the CMP script</h4>
<p><figure><a class="slb" href="/images/guides/consent-integration-blocked-cmp-script.png"><img src="/images/guides/consent-integration-blocked-cmp-script.png"
         alt="Blocked CMP script screenshot"
         title="Blocked CMP script screenshot"/>
    </a>
</figure>
In this scenario, the CMP script is blocked or unavailable. As shown in the debug output, Consent Integrations has prevented Tealium iQ from loading because there’s an active Consent Integration in place. The page view event is queued, but no further action occurs until the CMP script loads.</p>
<h4 id="scenario-2-cmp-in-opt-in-mode-before-cookies-are-accepted">Scenario 2: CMP in opt-in mode before cookies are accepted</h4>
<figure><a class="slb" href="/images/guides/consent-integration-opt-in-mode-before-cookies.png"><img src="/images/guides/consent-integration-opt-in-mode-before-cookies.png"
         alt="CMP in opt-in mode before cookies are accepted screenshot"
         title="CMP in opt-in mode before cookies are accepted screenshot"/>
    </a>
</figure>
<p>Here, the CMP is operating in opt-in mode, and the user has not yet provided explicit consent. Before the user accepts cookies, Consent Integrations detects implicit consent for purposes mapped to <code>Necessary</code> only, preventing other purposes from loading. Because we are in opt-in mode, the system continues to poll for an explicit consent decision.</p>
<h4 id="scenario-3-cmp-in-opt-in-mode-after-cookies-are-accepted">Scenario 3: CMP in opt-in mode after cookies are accepted</h4>
<figure><a class="slb" href="/images/guides/consent-integration-opt-in-mode-after-cookies.png"><img src="/images/guides/consent-integration-opt-in-mode-after-cookies.png"
         alt="CMP in opt-in mode after cookies are accepted screenshot"
         title="CMP in opt-in mode after cookies are accepted screenshot"/>
    </a>
</figure>
<p>In this scenario, after the user consents to cookies, Consent Integrations detects the explicit consent and reviews the newly consented purposes, excluding any that were already processed under implicit consent. It then checks for tags mapped to the newly consented purposes and queues them for firing. Note that any tags not mapped to a purpose remain blocked from loading.</p>
<p>For more information, see <a href="/iq-tag-management/consent/consent-integrations/validate-and-debug/">Validate and debug consent integrations</a>.</p>

</div>

<div class="mv30 nested-links overflow-hidden dpn flex justify-between flex-row-reverse"><div class="fr ml3">

  
  <a href="/guides/customer-spending-levels-guide/"
    class="inline-flex items-center-ns ba b--black-10 br3 pa3">
    <section class="tl pr3">
      <div>Customer spending levels</div>
    </section>
    <svg class="w1" data-icon="chevronRight" viewBox="0 0 32 32" style="fill:currentcolor;height:100%">
      <title>"Customer spending levels"</title>
      <path d="M12 1 L26 16 L12 31 L8 27 L18 16 L8 5 z"></path>
    </svg>
  </a>
  
  
</div><div class="di mr3">
  
  
  <a href="/guides/cart-abandonment-guide/"
    class="inline-flex items-center-ns ba b--black-10 br3 pa3">
    <svg class="w1" data-icon="chevronLeft" viewBox="0 0 32 32" style="fill:currentcolor;height:100%">
      <title>"Cart abandonment "</title>
      <path d="M20 1 L24 5 L14 16 L24 27 L20 31 L6 16 z"></path>
    </svg>
   <section class="tr pl3">
      <div>Cart abandonment</div>
    </section>
  </a>
  

</div></div>



        <div class="bt-l b--moon-gray pv3 cb">
          <div id="feedback_form" class="dpn">
  <div id="feedback_buttons">
	  <p class="di f5 pr2">Was this page helpful?</p>
		<button enabled id="feedback_yes" class="ba b--white bg-primary-color-light f5 ph2 pv2 br2 dib tc mv3 link primary-color-dark"><svg width="12" height="12" viewBox="0 0 12 12" fill="white" xmlns="http://www.w3.org/2000/svg">
<path d="M11.9593 5.91859C12.0445 6.23734 11.6882 6.55684 11.6882 6.55684C11.6882 6.55684 11.9552 7.05934 11.9293 7.53747C11.9061 7.97172 11.59 8.38572 11.59 8.38572C11.59 8.38572 11.7272 9.00709 11.5933 9.43197C11.4355 9.93184 11.0023 10.2476 11.0023 10.2476C11.0023 10.2476 10.9858 10.8026 10.7083 11.1618C10.4308 11.5211 9.89197 11.6846 9.89197 11.6846C9.89197 11.6846 9.11984 11.9996 8.25847 12.0225C7.26734 12.0487 6.16897 11.7825 6.16897 11.7825C6.16897 11.7825 5.66384 11.5338 5.04997 11.4063C4.33297 11.2578 3.49109 11.2275 3.49109 11.2275V6.55722C3.49109 6.55722 3.92309 6.50247 4.20472 6.10609C4.48934 5.70559 4.61197 5.07897 4.87709 4.57272C5.20484 3.94759 5.64659 3.47209 5.64659 3.42184C5.64659 3.36109 6.36209 2.81772 6.77797 2.04372C7.25572 1.15497 7.34497 0.0577174 7.34497 0.0577174C7.34497 0.0577174 7.89284 -0.0562825 8.27309 0.279342C8.72009 0.673842 8.81459 1.52734 8.81459 1.52734C8.81459 1.52734 8.70734 2.43784 8.39459 3.29284C8.16472 3.92134 7.89997 4.56484 7.89997 4.56484C7.89997 4.56484 8.01734 4.94434 8.54909 4.97059C8.97434 4.99159 9.63022 4.81759 10.1245 4.76172C10.7638 4.68972 11.1985 4.72797 11.1985 4.72797C11.1985 4.72797 11.8157 5.38234 11.9593 5.91859ZM-0.00390625 6.23022L2.73959 6.09972L2.80484 11.5867L0.387969 11.5541L-0.00390625 6.23022Z" fill="currentColor"/>
</svg>
Yes</button>
	  <button enabled id="feedback_no" class="ba b--white bg-primary-color-light f5 ph2 pv2 br2 dib tc mv3 link primary-color-dark"><svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M5.84642 0.22244C5.84642 0.22244 6.35117 0.471065 6.96467 0.59819C7.68129 0.74669 8.52242 0.77669 8.52242 0.77669V5.44394C8.52242 5.44394 8.09079 5.49832 7.80917 5.89469C7.52492 6.29482 7.40229 6.92144 7.13717 7.42694C6.80979 8.05132 6.36804 8.52682 6.36804 8.57669C6.36804 8.63744 5.65329 9.18044 5.23742 9.95369C4.76004 10.8421 4.67079 11.9382 4.67079 11.9382C4.67079 11.9382 4.12329 12.0522 3.74304 11.7166C3.29642 11.3224 3.20192 10.4693 3.20192 10.4693C3.20192 10.4693 3.30917 9.55919 3.62154 8.70494C3.85104 8.07682 4.11579 7.43369 4.11579 7.43369C4.11579 7.43369 3.99842 7.05457 3.46704 7.02832C3.04217 7.00732 2.38667 7.18132 1.89279 7.23682C1.25379 7.30882 0.819541 7.27057 0.819541 7.27057C0.819541 7.27057 0.202666 6.61694 0.0590409 6.08069C-0.0260841 5.76232 0.330166 5.44282 0.330166 5.44282C0.330166 5.44282 0.0635409 4.94069 0.0890409 4.46294C0.112291 4.02907 0.428041 3.61507 0.428041 3.61507C0.428041 3.61507 0.290791 2.99407 0.424666 2.56994C0.582541 2.07044 1.01529 1.75507 1.01529 1.75507C1.01529 1.75507 1.03179 1.20044 1.30892 0.84119C1.58642 0.482315 2.12492 0.318815 2.12492 0.318815C2.12492 0.318815 2.89667 0.00381546 3.75729 -0.0186845C4.74767 -0.0449345 5.84529 0.22094 5.84529 0.22094L5.84642 0.22244ZM11.6229 0.450815L12.0148 5.77057L9.27354 5.90107L9.20829 0.41819L11.6229 0.450815Z" fill="currentColor"/>
</svg>
No</button>
  </div>
	<div id="feedback_comment" style="display: none;">
		<textarea id="feedback_textarea" class="ba b--light-gray bg-primary-color-light pa2 br3" type="text" placeholder="Tell us how we can make this article better." rows="4" cols="60"></textarea><button id="feedback_submit" class="db ba b--light-gray bg-primary-color-light f5 ph3 pv2 br2 dib tc mv3 link primary-color-dark">Send Feedback</button>
  </div>
  <div id="feedback_thank_you" style="display: none;">
     <p class="i">Thank you for your feedback!</p>
  </div>
</div>

        </div>
        <div class="bt-l b--moon-gray pt3 f6">
          <p>This page was last updated:  December 10, 2024 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          </p>
        </div>
      </div>
    </article>

    <nav id="toc" class="order-2 w-20 pl4 mv4 sticky-r dn db-ns max-vh-100 overflow-y-auto">
      



  <aside class="mw5 right-0 f6 bl b--light-gray pv4 pv0-ns ph3 nested-copy-line-height">
      <p class="b ttu">On this page</p>
      <nav id="TableOfContents"><ul class="toc-h2"><li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#requirements" href="javascript:void(0)">Requirements</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#load-the-cmp-script" href="javascript:void(0)">Load the CMP script</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#configure-onetrust-consent-integration-in-tealium-iq" href="javascript:void(0)">Configure OneTrust Consent Integration in Tealium iQ</a></li>
              <ul class="toc-h3"><li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-1-configure-the-integration" href="javascript:void(0)">Step 1: Configure the integration</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-2-set-enforcement-rules" href="javascript:void(0)">Step 2: Set enforcement rules</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-3-select-publish-location" href="javascript:void(0)">Step 3: Select publish location</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-4-select-purpose-group" href="javascript:void(0)">Step 4: Select purpose group</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-5-edit-purpose-group" href="javascript:void(0)">Step 5: Edit purpose group</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-6-assign-tealium-iq-to-a-purpose" href="javascript:void(0)">Step 6: Assign Tealium iQ to a purpose</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-7-map-tags-to-purposes" href="javascript:void(0)">Step 7: Map tags to purposes</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#step-8-publish-the-configuration" href="javascript:void(0)">Step 8: Publish the configuration</a></li>
              </ul><li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#test-and-troubleshoot" href="javascript:void(0)">Test and troubleshoot</a></li>
              <ul class="toc-h3"><li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#check-the-data-layer" href="javascript:void(0)">Check the data layer</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#verify-your-consent-integration-setup" href="javascript:void(0)">Verify your Consent Integration setup</a></li>
              <li class="db mv2 f6"><a class="w-100 text-color-primary hover-primary-color link" data-id="#use-the-debug-mode-to-view-additional-information" href="javascript:void(0)">Use the debug mode to view additional information</a></li>
              </nav>
  </aside></nav>

</div>
</div>
    

    </main>

    <footer class="bg-secondary ph1-ns relative w-100 pv4 bt b--light-gray" role="contentinfo">
  <div class="center flex-ns flex-wrap justify-between mw9 w-90 dn db-ns">

    <div class="flex nested-links w-33">
      <ul class="list v-top mt0 pt0">
        <li class="nav-list footer-heading-title">
          <div class="footer-logo-wrapper">
            <img class="logo" src="https://tealium.com/wp-content/uploads/2015/12/tealium_footer_logo_01-206x49.png" alt="tealium_footer_logo_01">
          </div>
        </li>
      </ul>
    </div>
    
    <div class="flex nested-links w-33">
      <ul class="list v-top mt0 pt0">
        <li class="fw5 f5 mb3 ttu o-50">Support</li>
<li class="mb2"><a class="link" href="https://university.tealium.com/">Tealium University</a></li>
<li class="mb2"><a class="link" href="https://support.tealiumiq.com/en/support/solutions">Knowledge Base</a></li>
<li class="mb2"><a class="link" href="https://support.tealiumiq.com/" target="">Support Desk</a></li>
      </ul>
    </div>
    
    <div class="flex nested-links w-33">
      <ul class="list v-top mt0 pt0">
        <li class="fw5 f5 mb3 ttu o-50">Company</li>
        <li class="mb2">
          <a class="link" href="http://tealium.com/">Tealium.com</a>
        </li>
        <li class="mb2">
          <a class="link" href="http://tealium.com/blog/">Blog</a>
        </li>
        <li class="mb2">
          <a class="link" href="https://tealium.com/careers/">Careers</a>
        </li>
      </ul>
    </div>

  </div>
</div>

  <div class="dpn bg-primary-color-dark bottom-0 left-0 right-0 dn-ns db fixed pb3 ph3 w-100">
<div class="globalmenu mobilemenu dn">
    

<ul class="list hidden dib ph0 ma0 scrolling-touch tc">
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Home
        </a>
    </li>
  
  
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/guides/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Guides
        </a>
    </li>
  
  
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/iq-tag-management/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          iQ Tag Management
        </a>
    </li>
  
  
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          EventStream API Hub
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          AudienceStream CDP
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/moments-api/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Moments API
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/functions/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Functions
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/data-connect/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Data Connect
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/predict/getting-started/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Predict ML
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/data-storage/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          DataAccess
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side/insights/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Tealium Insights
        </a>
    </li>
  
  
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/client-side-tags/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Client-Side Tags
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/server-side-connectors/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Server-Side Connectors
        </a>
    </li>
  
  
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/platforms/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Platforms
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/api/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          API
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/administration/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Administration
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/industries/tealium-for-pharma/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Tealium for Pharma
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/industries/tealium-identity-partners/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Tealium Identity Partners
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/tech-partners/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Technology Partners
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/partners/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Partner Integrations
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/glossary/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Glossary
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/early-access/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Early Access
        </a>
    </li>
  
  
  
    <li  class="tl dib ma0 hover-bg-primary w-100">
        <a href="https://docs.tealium.com/release-notes/" class="f5 link primary-color-light overflow hover-white db ma0 w-100 pv3 ph4">
          Release Notes
        </a>
    </li>
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
  
</ul>

</div>


<div class="docsmenu mobilemenu dn" style="overflow-y:scroll;">
    <ul class="list dib ph0 ma0 scrolling-touch tc">
  
  
  
  
  
  
  
  
  
  
  

</ul>

</div>




<div class="flex dn-l justify-between">
  <button class="js-toggle flex-auto dib dn-l f6 tc db mt3 ph3 pv2 link mr2 white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".globalmenu">Site</button>

  <button class="js-toggle flex-auto dib dn-l f6 tc db mt3 ph3 pv2 link white bg-primary-color-dark hover-bg-primary-color ba b--white-40 w-auto" data-target=".docsmenu">Section</button>

</div>
</div>

</footer>

    <script src="/dist/js/app.js"></script>

<script async defer src="https://buttons.github.io/buttons.js"></script>
<script src="https://kit.fontawesome.com/59194dc628.js" crossorigin="anonymous"></script>


    
      
<script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script>
<script type="text/javascript">
const translations = {
  button: {
    buttonText: 'Search',
    buttonAriaLabel: 'Search',
  },
  modal: {
    searchBox: {
      resetButtonTitle: 'Clear the query',
      resetButtonAriaLabel: 'Clear the query',
      cancelButtonText: 'Cancel',
      cancelButtonAriaLabel: 'Cancel',
    },
    startScreen: {
      recentSearchesTitle: 'Recent',
      noRecentSearchesText: 'No recent searches',
      saveRecentSearchButtonTitle: 'Save this search',
      removeRecentSearchButtonTitle: 'Remove this search from history',
      favoriteSearchesTitle: 'Favorite',
      removeFavoriteSearchButtonTitle: 'Remove this search from favorites',
    },
    errorScreen: {
      titleText: 'Unable to fetch results',
      helpText: 'You might want to check your network connection.',
    },
    footer: {
      selectText: 'to select',
      selectKeyAriaLabel: 'Enter key',
      navigateText: 'to navigate',
      navigateUpKeyAriaLabel: 'Arrow up',
      navigateDownKeyAriaLabel: 'Arrow down',
      closeText: 'to close',
      closeKeyAriaLabel: 'Escape key',
      searchByText: 'Search by',
    },
    noResultsScreen: {
      noResultsText: 'No results for',
      suggestedQueryText: 'Try searching for',
      reportMissingResultsText: 'Believe this query should return results?',
      reportMissingResultsLinkText: 'Let us know.',
    },
  },
};
var default_sections = [
];
var ls_sections = JSON.parse(localStorage.getItem("tealdocs_sections") || "[]");
if(ls_sections.indexOf("JAVASCRIPT") != -1) {
  ls_sections = [];
  localStorage.setItem("tealdocs_sections", JSON.stringify(default_sections));
}
var local_sections = new Set(ls_sections);
var cur_section = $('#breadcrumb ul li:nth-child(n+2)');
if(cur_section && cur_section.length) {
  var sect = cur_section.text().trim();
  if(local_sections.has(sect)) {
    
    local_sections.delete(sect);
    local_sections.add(sect);
  }
  else {
    
    local_sections.add(sect);
    if(local_sections.size > 10) {
      local_sections.delete(ls_sections[0]);
    }
  }
  localStorage.setItem("tealdocs_sections", JSON.stringify(Array.from(local_sections)));
}
var filt_pre = "hierarchy.lvl0:";
var hier_filters = local_sections.size ? Array.from(local_sections).map(s => filt_pre+s)
  : default_sections.map(s => filt_pre+s);
var opt_filters = [];
if(hier_filters.length) {
  opt_filters.push(hier_filters);
}
const transformItems = function(hits) {
  hits.map(hit => {
    if (hit.url.indexOf('#breadcrumb') > 0) {
      hit.url = hit.url.replace('#breadcrumb', '');
    }
  });
  return hits;
};
docsearch({
  container: '#docsearch',
  appId: '01G44CJWZ0',
  apiKey: '09633c367e743588b87dbb988dad4158',
  indexName: 'tealium',
  placeholder: 'Search',
  translations: translations,
  searchParameters: {
    "hitsPerPage": 50,
    "analytics": true ,
    "analyticsTags": ["site"]
  },
  insights: true,
  debug: false ,
  transformItems
});
</script>

    

  </body>
</html>
