
{
    "kind": "term",
    "name": "ss_cloud-stream_data-sources",
    "count": 1,
    "items": [

    
        {
            "weight": "100",
            "url": "https://docs.tealium.com/ja/server-side/functions/data-record-functions/data-record-functions/",
            "title": "データレコード機能について",
            "body": "<p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>CloudStream機能を有効にするには、<strong>管理メニュー</strong> &gt; <strong>サーバーサイド構成</strong> &gt; <strong>CloudStreamコネクタ</strong>に移動し、<strong>CloudStreamコネクタを有効にする</strong>を<code>On</code>に構成し、<strong>保存</strong>をクリックします。</p>\n<h2 id=\"動作原理\">動作原理</h2>\n<p>CloudStreamの機能はCloudStreamデータパイプライン内で動作し、クラウドデータソースから照会されたデータレコードにアクセスできます。CloudStreamプロファイル内の機能を使用して、他のシステムからデータを取得したり、データを増強したり、他のエンドポイントにデータを送信したりします。</p>\n<p>CloudStream機能の追加と管理は、他の機能の管理と同じですが、以下の例外があります：</p>\n<ul>\n<li>機能を作成する際に、対象者やイベントを選択する代わりに、<a href=\"/ja/server-side/cloudstream/about/\">クラウドデータソース</a>と<a href=\"/ja/server-side/cloudstream/about/\">セグメント</a>を選択します。</li>\n<li>各CloudStream機能は、一つのデータソースからのデータのみを使用できます。追加のデータソースからデータをアクティブにする場合は、それぞれに対して別の機能を構成します。</li>\n<li>セグメントに複数のデータソースからマッピングされた属性が含まれている場合、選択したデータソースの属性のみが機能で利用可能です。</li>\n</ul>\n<p>機能についての詳細は、<a href=\"/ja/server-side/functions/about/\">関数について</a>を参照してください。</p>\n<h2 id=\"トリガー\">トリガー</h2>\n<p>CloudStreamデータレコード機能は、データレコードが処理された後にトリガーされます。以下のCloudStreamデータパイプライン図に示されています：</p>\n<figure><a class=\"slb\" href=\"/images/server-side/functions-data-record-pipeline.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-data-record-pipeline.png\"/>\n    </a>\n</figure>\n<p>このパイプラインの時点で機能を使用して、データレコードを他のシステムに送信します。</p>\n<p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>この時点でのCloudStreamデータパイプラインでは、<code>dataRecord</code>オブジェクトの変更はシステムの他の部分には影響しません。</p>\n<h2 id=\"ランタイムバージョン\">ランタイムバージョン</h2>\n<p>現在のランタイムバージョンは<a href=\"/ja/server-side/functions/event-visitor-functions/event-visitor-v3/\">event and visitor functions V3</a>と同じですが、以下の変更が含まれています：</p>\n<ul>\n<li><code>track</code>ライブラリが削除されました。</li>\n<li>データレコードを新しいイベントとしてTealiumに送り返すことはできません。</li>\n</ul>\n<h2 id=\"activate関数\">activate()関数</h2>\n<p>データレコード機能を作成すると、関数コードエディタの<strong>コード</strong>タブにデフォルトのコードが表示されます：</p>\n<figure><a class=\"slb\" href=\"/images/early-access/cloudstream/cloudstream_function_details.png\"><img src=\"https://docs.tealium.com/images/early-access/cloudstream/cloudstream_function_details.png\"/>\n    </a>\n</figure>\n<p>このコードには<code>activate()</code>関数とその入力パラメータが含まれています。</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">activate</span>(<span style=\"color:#66d9ef\">async</span> ({ <span style=\"color:#a6e22e\">dataRecord</span>, <span style=\"color:#a6e22e\">helper</span> }) =&gt; {\n</span></span><span style=\"display:flex;\"><span>  ...\n</span></span><span style=\"display:flex;\"><span>});\n</span></span></code></pre></div><p>データレコード機能には<a href=\"#data-record-object\"><code>dataRecord object</code></a>と<code>helper</code>オブジェクトがあります。</p>\n<p><code>helper</code>パラメータは<code>helper.getAuth()</code>と<code>helper.getGlobalVariable()</code>を提供して、認証を取得し、グローバル変数を取得します。詳細については、<a href=\"/ja/server-side/functions/event-visitor-functions/event-visitor-v3/\">イベントおよび訪問関数 V3</a>を参照してください。</p>\n<p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>認証トークンはHTTPリクエスト内の関数からのみ参照できます。HTTPリクエストの外でトークンを参照しようとすると、トークンはUUIDプレースホルダーに置き換えられます。</p>\n<h3 id=\"データレコードオブジェクト\">データレコードオブジェクト</h3>\n<p><code>dataRecord</code>オブジェクトはCloudStream機能で利用可能で、次のプロパティを含んでいます：</p>\n<table>\n<thead>\n<tr>\n<th>プロパティ</th>\n<th>データタイプ</th>\n<th>説明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>account</code></td>\n<td>string</td>\n<td>Tealiumアカウント名。</td>\n</tr>\n<tr>\n<td><code>data</code></td>\n<td>object</td>\n<td>クラウドデータソースから照会されたデータレコード、<code>dataRecord.data.udo</code>で参照されます。</td>\n</tr>\n<tr>\n<td><code>event_id</code></td>\n<td>string</td>\n<td>TealiumイベントID。</td>\n</tr>\n<tr>\n<td><code>post_time</code></td>\n<td>number</td>\n<td>データレコードが照会された時のタイムスタンプ。</td>\n</tr>\n<tr>\n<td><code>profile</code></td>\n<td>string</td>\n<td>Tealiumプロファイル名。</td>\n</tr>\n<tr>\n<td><code>dataSourceId</code></td>\n<td>string</td>\n<td>データソースのID。</td>\n</tr>\n</tbody>\n</table>\n<p>データレコードオブジェクトの例：</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-json\" data-lang=\"json\"><span style=\"display:flex;\"><span>{\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;account&#34;</span>: <span style=\"color:#e6db74\">&#34;your-account&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;profile&#34;</span>: <span style=\"color:#e6db74\">&#34;your-profile&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;data&#34;</span>: {\n</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;udo&#34;</span>: {\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;CDW_Column1_Timestamp&#34;</span>: <span style=\"color:#ae81ff\">1753077016157</span>,\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;CDW_Column2_Id&#34;</span>: <span style=\"color:#ae81ff\">10</span>,\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;CDW_Column3_EmailAddress&#34;</span>: <span style=\"color:#e6db74\">&#34;user@example.com&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;_dc_ttl_&#34;</span>: <span style=\"color:#ae81ff\">60000</span>,\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_datasource&#34;</span>: <span style=\"color:#e6db74\">&#34;abcdefg&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_event&#34;</span>: <span style=\"color:#e6db74\">&#34;data_ingestion&#34;</span>\n</span></span><span style=\"display:flex;\"><span>    }\n</span></span><span style=\"display:flex;\"><span>  },\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;dataSourceId&#34;</span>: <span style=\"color:#e6db74\">&#34;abcdefg&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;event_id&#34;</span>: <span style=\"color:#e6db74\">&#34;cf8bd406-787b-4fe9-8b45-7782e6663708&#34;</span>,\n</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;post_time&#34;</span>: <span style=\"color:#ae81ff\">1753774131897</span>,\n</span></span><span style=\"display:flex;\"><span>}\n</span></span></code></pre></div><h3 id=\"例\">例</h3>\n<p>これは、データレコードからメールアドレス属性（<code>CDW_Column3_EmailAddress</code>）をハッシュ化し、その後データレコードをウェブフックに送信するCloudStream機能の例です。</p>\n<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-javascript\" data-lang=\"javascript\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">import</span> <span style=\"color:#a6e22e\">C</span> <span style=\"color:#a6e22e\">from</span> <span style=\"color:#e6db74\">&#34;tealium/crypto&#34;</span>;\n</span></span><span style=\"display:flex;\"><span>\n</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">send</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#66d9ef\">async</span> (<span style=\"color:#a6e22e\">data</span>) =&gt; {\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#e6db74\">&#34;Sending: &#34;</span> <span style=\"color:#f92672\">+</span> <span style=\"color:#a6e22e\">JSON</span>.<span style=\"color:#a6e22e\">stringify</span>(<span style=\"color:#a6e22e\">data</span>, <span style=\"color:#66d9ef\">null</span>, <span style=\"color:#ae81ff\">2</span>));\n</span></span><span style=\"display:flex;\"><span>\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#66d9ef\">return</span> <span style=\"color:#a6e22e\">fetch</span>(<span style=\"color:#e6db74\">&#34;https://example.com/example-webhook/&#34;</span>, {\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">method</span><span style=\"color:#f92672\">:</span> <span style=\"color:#e6db74\">&#39;POST&#39;</span>,\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">headers</span><span style=\"color:#f92672\">:</span> {\n</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#e6db74\">&#39;Accept&#39;</span><span style=\"color:#f92672\">:</span> <span style=\"color:#e6db74\">&#39;application/json&#39;</span>,\n</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#e6db74\">&#39;Content-Type&#39;</span><span style=\"color:#f92672\">:</span> <span style=\"color:#e6db74\">&#39;application/json&#39;</span>\n</span></span><span style=\"display:flex;\"><span>        },\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">body</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">JSON</span>.<span style=\"color:#a6e22e\">stringify</span>(<span style=\"color:#a6e22e\">data</span>)\n</span></span><span style=\"display:flex;\"><span>});\n</span></span><span style=\"display:flex;\"><span>}\n</span></span><span style=\"display:flex;\"><span>\n</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">activate</span>(<span style=\"color:#66d9ef\">async</span> ({ <span style=\"color:#a6e22e\">dataRecord</span> }) =&gt; {\n</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">data</span> <span style=\"color:#f92672\">=</span> { ...<span style=\"color:#a6e22e\">dataRecord</span>.<span style=\"color:#a6e22e\">data</span>.<span style=\"color:#a6e22e\">udo</span>  };\n</span></span><span style=\"display:flex;\"><span>\n</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#a6e22e\">data</span>.<span style=\"color:#a6e22e\">tc_email</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">C</span>.<span style=\"color:#a6e22e\">SHA3</span>(<span style=\"color:#a6e22e\">dataRecord</span>.<span style=\"color:#a6e22e\">data</span>.<span style=\"color:#a6e22e\">udo</span>.<span style=\"color:#a6e22e\">CDW_Column3_EmailAddress</span>).<span style=\"color:#a6e22e\">toString</span>(<span style=\"color:#a6e22e\">C</span>.<span style=\"color:#a6e22e\">enc</span>.<span style=\"color:#a6e22e\">Hex</span>);\n</span></span><span style=\"display:flex;\"><span>\n</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">try</span> {\n</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">await</span> <span style=\"color:#a6e22e\">send</span>(<span style=\"color:#a6e22e\">data</span>);\n</span></span><span style=\"display:flex;\"><span>    } <span style=\"color:#66d9ef\">catch</span> (<span style=\"color:#a6e22e\">e</span>) {\n</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">error</span>(<span style=\"color:#e6db74\">&#34;Failed to send the data. &#34;</span> <span style=\"color:#f92672\">+</span> <span style=\"color:#a6e22e\">e</span>);\n</span></span><span style=\"display:flex;\"><span>    }\n</span></span><span style=\"display:flex;\"><span>});\n</span></span></code></pre></div>"
        }  

    ]
}
