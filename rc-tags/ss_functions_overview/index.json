
{
    "kind": "term",
    "name": "ss_functions_overview",
    "count": 11,
    "items": [

    
        {
            "weight": "5",
            "url": "https://docs.tealium.com/server-side/functions/about/",
            "title": "About functions",
            "body":"<h2 id=\"function-types\">Function types</h2><p>Tealium currently supports the following function types:</p><ul><li><strong>Data Transformation Functions</strong> – Functions that are triggered after an event is received by Tealium Collect and when the trigger conditions for the function are met.For more information, see <a href=\"/server-side/functions/data-transformation-functions/about/\">About Data Transformation Functions</a>.</li><li><strong>Event Functions</strong> – Functions that are triggered after an event is processed. For more information, see <a href=\"/server-side/functions/event-visitor-functions/about/\">About Event and Visitor Functions</a>.To use functions that are triggered by processed events, you must have Tealium EventStream API Hub enabled. For more information, see <a href=\"/server-side/getting-started/eventstream-api-hub/introduction/\">Introduction to EventStream</a>.</li><li><strong>Visitor Functions</strong> – Functions that are triggered after a visitor is processed. For more information, see <a href=\"/server-side/functions/event-visitor-functions/about/\">About Event and Visitor Functions</a>.To use functions that are triggered by processed visitors, you must have Tealium AudienceStream CDP enabled. For more information, see <a href=\"/server-side/getting-started/audiencestream-cdp/introduction/\">Introduction to AudienceStream</a>.</li></ul><h2 id=\"key-benefits\">Key benefits</h2><p>Functions provides a serverless environment that allows you to extend the functionality of the Customer Data Hub to suit your needs.</p><h3 id=\"serverless-environment\">Serverless environment</h3><p>In the serverless functions environment, functions are hosted on the Tealium Platform. Tealium manages the servers and platform software and you can focus on implementing functions for your unique data needs. Resources, such as memory, are allocated automatically each time a function is invoked. For more information, see <a href=\"/server-side/functions/environment/\">execution environment and rate limits</a>.</p><h3 id=\"extend-the-customer-data-hub\">Extend the Customer Data Hub</h3><p>You can use data transformation functions to modify incoming event data. For example, a data transformation function can flatten nested objects, remove sensitive data, or populate variables in the event object.</p><p>You can use event and visitor functions to retrieve data from other systems, augment Tealium data, or send data to other endpoints. If a function modifies visitor or event data, the changes are local to the function and do not affect the Tealium data. Functions can send the modified data to Tealium Collect, where it is processed again and the changes are reflected in Tealium data.</p><p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>There is a cost associated with sending event or visitor data to the Tealium Collect endpoint because the number of events is increased each time data is sent. For more information, see <a href=\"/server-side/administration/understanding-the-usage-report/#billing-estimation\">Billing estimation</a>.</p>"
        }  

    , 
        {
            "weight": "10",
            "url": "https://docs.tealium.com/server-side/functions/triggers/",
            "title": "Function triggers",
            "body":"<p>Functions are triggered by events at different points in the data pipeline, depending on the function type.</p><h2 id=\"data-transformation-functions\">Data transformation functions</h2><p>Data transformation functions have custom triggers, which are rules that specify the conditions that trigger execution of a function. If the trigger conditions for a data transformation function are met, the function is invoked after the event is collected from the data source and before the event is processed, as shown in the following data pipeline diagram. Data transformation functions support all event types except for file import events.</p><figure><a class=\"slb\" href=\"/images/server-side/data-source-event-collected.png\"><img src=\"https://docs.tealium.com/images/server-side/data-source-event-collected.png\"         alt=\"data-source-event-collected.png\"         title=\"data-source-event-collected.png\"/>    </a></figure><p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>Only one function can be triggered by a custom trigger. If an event matches more than one function trigger, the function with the oldest <strong>Date Modified</strong> is the only function that is triggered.</p><p>For more information, see <a href=\"/server-side/functions/data-transformation-functions/about/\">About Data Transformation Functions</a>.</p><h2 id=\"event-and-visitor-functions\">Event and visitor functions</h2><p>Event and visitor functions are invoked after the event or visitor has been processed, as shown in the following data pipeline diagram.</p><figure><a class=\"slb\" href=\"/images/server-side/processedeventfeed-full.png\"><img src=\"https://docs.tealium.com/images/server-side/processedeventfeed-full.png\"         alt=\"ProcessedEventFeed_Full.png\"         title=\"ProcessedEventFeed_Full.png\"/>    </a></figure><p>For more information, see <a href=\"/server-side/functions/event-visitor-functions/about/\">About Event and Visitor Functions</a>.</p>"
        }  

    , 
        {
            "weight": "15",
            "url": "https://docs.tealium.com/server-side/functions/environment/",
            "title": "Execution environment and rate limits",
            "body":"<h2 id=\"execution-environment\">Execution environment</h2><p>The functions execution environment is built on the <a href=\"https://www.graalvm.org/%22\">GraalVM</a> JavaScript runtime and runs ECMAScript 2020 compatible code.</p><p>Functions have the following limitations:</p><ul><li>Functions cannot use third-party libraries except the libraries listed in <a href=\"/server-side/functions/modules/\">APIs and libraries for functions</a>.</li><li>Functions have 32 MB of memory.<br>If a function attempts to use more than 32 MB, the following error is written to the log:<br><code>Exception 400 BAD REQUEST - OutOfMemoryError: memory limit 32 mb is exceeded.</code></li></ul><h3 id=\"runtime-versions\">Runtime Versions</h3><p>The execution environment for functions, referred to as the runtime version, varies depending on the function type, as follows:</p><ul><li><strong>Data Transformation Functions</strong> – The current runtime version is Transformation V0. For more information, see <a href=\"/server-side/functions/data-transformation-functions/about/\">About Data Transformation Functions</a>.</li><li><strong>Event and Visitor Functions</strong> – The latest runtime version is Action V3. Existing functions use Action V2, which is deprecated. For more information, see the following:<ul><li><a href=\"/server-side/functions/event-visitor-functions/v2-functions/\">Event and visitor functions V2</a></li><li><a href=\"/server-side/functions/event-visitor-functions/event-visitor-v3/\">Event and visitor functions V3</a></li><li><a href=\"/server-side/functions/event-visitor-functions/migrate-v2-to-v3/\">Migrate a V2 function to V3</a></li></ul></li></ul><p>The runtime version for a function is shown in the code tab of the code editor, as shown below: <figure><a class=\"slb\" href=\"/images/server-side/functions-runtime-version-location.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-runtime-version-location.png\"         alt=\"functions-runtime-version-location.png\"         title=\"functions-runtime-version-location.png\"/>    </a></figure></p><p>Runtime versions may be updated to provide new features. When a new runtime version is available, a message similar to the following is displayed on the <strong>Functions Overview</strong> page: <figure><a class=\"slb\" href=\"/images/server-side/functions-new-runtime-available.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-new-runtime-available.png\"         alt=\"functions-runtime-version-location.png\"         title=\"functions-runtime-version-location.png\"/>    </a></figure></p><p>As Tealium releases new runtime versions, older versions will be deprecated, and will eventually become obsolete. A message is displayed on the <strong>Functions Overview</strong> screen and on the <strong>Code</strong> tab for a function when the runtime version in use is deprecated or becomes obsolete.</p><h2 id=\"execution-time-limits-for-data-transformation-functions\">Execution time limits for data transformation functions</h2><p>Data transformation functions have the following execution limits:</p><ul><li>1 hour of execution time per minute OR</li><li>250,000 invocations per minute (15 mm per hour)</li><li>150 milliseconds of execution time for each function invocation<br>If a function exceeds the 150 milliseconds execution time, the following error is written to the log:<br><code>Invocation timeout limit of 150 milliseconds is exceeded</code></li></ul><p>These execution limits are based on the account and the region. The sum of the execution time and the number of invocations for all functions in an account for a region cannot exceed these limits.</p><p>If either limit is exceeded, function execution is briefly stopped (throttled). The following message is displayed in the <strong>Functions Overview</strong> and a yellow alert icon is displayed next to a throttled function, as follows:</p><figure><a class=\"slb\" href=\"/images/server-side/throttle-msg.png\"><img src=\"https://docs.tealium.com/images/server-side/throttle-msg.png\"         alt=\"throttle-msg.png\"         title=\"throttle-msg.png\"/>    </a></figure><p>For information on how to view details for throttled functions, see <a href=\"/server-side/functions/manage-functions/view-function-statistics/\">View function statistics</a>.</p><h2 id=\"execution-time-limits-for-event-and-visitor-functions\">Execution time limits for event and visitor functions</h2><p>Event and visitor functions have the following execution limits:</p><ul><li>Execution rate: 180,000 events per minute</li><li>Execution time: 8 hours per minute</li><li>Execution time for each function invocation: 10 seconds<br>If a function exceeds the 10 seconds execution time, the following error is written to the log:<br><code>Exception 504 - Invocation timeout limit of 10000 milliseconds is exceeded.</code></li></ul><h2 id=\"execution-rate-and-execution-time-example-1\">Execution rate and execution time: example 1</h2><p>In this example, we assume that function that communicates with external APIs takes about 100 ms per invocation. In addition, we assume there is only one function configured for the account and the average execution rate of this function is 1000 invocations per second.</p><p>The execution rate and execution time within a 1-minute time window are as follows:</p><p>Execution rate = 1000 * 60 * 1 min = <strong>execution rate of 60,000 invocations per minute</strong></p><p>Execution time = 1000 invocations/second * 100 ms / 1000 = 100 minutes = <strong>1.66 hours execution time per minute</strong></p><p>In this case, the execution rate and execution time are both below the limits.</p><h2 id=\"execution-rate-and-execution-time-example-2\">Execution rate and execution time: example 2</h2><p>In this example, we assume that external API performance temporarily degrades, and the function execution time is 800 ms per invocation. That means that our execution time is increased by 8.</p><p>Execution time = (1000 inv/s * 100 ms / 1000) * 8 = 800 minutes = <strong>13.28 hours of execution time per minute</strong>.</p><p>The execution time in this case is 13.28 hours per minute, which is greater than 8 hours/minute maximum. Function invocations may be throttled.</p>"
        }  

    , 
        {
            "weight": "20",
            "url": "https://docs.tealium.com/server-side/functions/code-editor/",
            "title": "Functions code editor",
            "body":"<p>The Tealium Functions code editor provides tabs for creating, configuring, testing, and monitoring functions, as well as viewing logs and getting an authentication token.</p><figure><a class=\"slb\" href=\"/images/server-side/functions-code-editor.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-code-editor.png\"         alt=\"functions-code-editor.png\"         title=\"functions-code-editor.png\"/>    </a></figure><h2 id=\"code-tab\">Code tab</h2><p>When you create a new function, the <strong>Code</strong> tab displays example function code with explanations in comments. You can modify the example code, or replace it with your own code.</p><h2 id=\"monitoring-tab\">Monitoring tab</h2><p>The <strong>Monitoring</strong> tab displays the following function statistics for the last hour, 12 hours, day, 7 days, or 30 days:</p><ul><li>Invocations</li><li>Average Execution Time</li><li>Errors</li></ul><h2 id=\"logs-tab\">Logs tab</h2><p>The <strong>Logs</strong> tab displays a list of log files from function execution. Log files are kept for 30 days. Functions can use the JavaScript console functions to write messages and errors to the log. For more information, see <a href=\"/server-side/functions/modules/#javascript-console-api\">JavaScript console API</a>.</p><h2 id=\"configuration-tab\">Configuration tab</h2><p>Use the <strong>Configuration</strong> tab to change the function name, add or change notes about the function, or change the event or audience that triggers the function. The feed cannot be changed after the initial function configuration.</p><h2 id=\"test-tab\">Test tab</h2><p>Use the <strong>Test</strong> tab to create a test payload and test your function. You can modify the example payload shown in the <strong>Test</strong> tab, or use test data from your website. For more information on obtaining test data from your website, see <a href=\"/server-side/functions/manage-functions/test-functions/\">Test Functions</a>. Test results and log files are available after the function is executed.</p><h2 id=\"advanced-tab\">Advanced tab</h2><p>Use the <strong>Advanced</strong> tab to assign authentication tokens to a function.</p>"
        }  

    , 
        {
            "weight": "20",
            "url": "https://docs.tealium.com/server-side/functions/event-visitor-functions/v2-functions/",
            "title": "Event and visitor functions V2",
            "body":"<p>Existing event and visitor functions use the V2 runtime, which is deprecated. New functions use the V3 runtime by default. For information on functions that use the V3 runtime and converting a V2 function to V3, see <a href=\"/server-side/functions/event-visitor-functions/event-visitor-v3/\">Event and Visitor Functions V3</a> and <a href=\"/server-side/functions/event-visitor-functions/migrate-v2-to-v3/\">Migrate a V2 function to the V3 runtime</a>.</p><h2 id=\"named-exports\">Named exports</h2><p>The Tealium module exports five named exports for event and visitor functions: <code>auth</code>, <code>event</code>, <code>visitor</code>, <code>store</code>, and <code>tealium</code>. Functions import these named exports as follows:</p><pre tabindex=\"0\"><code>import { auth, visitor, event, store, tealium } from &#34;tealium&#34;; </code></pre><h3 id=\"event-object\">Event object</h3><p>The <code>event</code> object is available when a function is triggered by the event feed and contains the event data.</p><table><thead><tr><th><strong>Property</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>event.id</code></td><td>string</td><td>Tealium Event ID.</td></tr><tr><td><code>event.visitor_id</code></td><td>string</td><td>Tealium Visitor ID.</td></tr><tr><td><code>event.account</code></td><td>string</td><td>Tealium Account.</td></tr><tr><td><code>event.profile</code></td><td>string</td><td>Tealium Profile.</td></tr><tr><td><code>event.data</code></td><td>object</td><td>An object that contains event attribute data, such as <code>event.data.udo.page_category</code> or <code>event.data.udo.order_id</code>.</td></tr></tbody></table><h4 id=\"event-object-example\">Event object example</h4><p>The following shows an example of event object data:</p><pre tabindex=\"0\"><code>{  &#34;account&#34;: &#34;your-account&#34;,  &#34;profile&#34;: &#34;main&#34;,  &#34;event_id&#34;: &#34;run-test-event-id&#34;,  &#34;visitor_id&#34;: &#34;run-test-visitor-id&#34;,  &#34;data&#34;: {    &#34;dom&#34;: {      &#34;viewport_height&#34;: 766,      &#34;referrer&#34;: &#34;&#34;,      &#34;viewport_width&#34;: 1440,      &#34;domain&#34;: &#34;www.example.com&#34;,      &#34;title&#34;: &#34;Home Page&#34;,      &#34;query_string&#34;: &#34;q=help&#34;,      &#34;hash&#34;: &#34;&#34;,      &#34;url&#34;: &#34;https://www.example.com/?q=help&#34;,      &#34;pathname&#34;: &#34;/&#34;    },    &#34;udo&#34;: {      &#34;tealium_event&#34;: &#34;page_view&#34;,      &#34;ut.account&#34;: &#34;your-account&#34;,      &#34;ut.visitor_id&#34;: &#34;0176cb4f3482110a5ba4702e147b0006d005a065104f2&#34;,      &#34;page_name&#34;: &#34;Home Page&#34;,      &#34;ut.event&#34;: &#34;view&#34;,      &#34;search_keyword&#34;: &#34;help&#34;,      &#34;ut.domain&#34;: &#34;example.com&#34;,      &#34;tealium_profile&#34;: &#34;main&#34;,      &#34;ut.version&#34;: &#34;ut4.46.202006020705&#34;,      &#34;tealium_session_id&#34;: &#34;1609910608323&#34;,      &#34;tealium_account&#34;: &#34;your-account&#34;,      &#34;ut.profile&#34;: &#34;main&#34;,    },    &#34;firstparty_tealium_cookies&#34;: {      &#34;utag_main__sn&#34;: &#34;12&#34;,      &#34;utag_main_dc_visit&#34;: &#34;12&#34;,      &#34;utag_main_ses_id&#34;: &#34;1609910610822&#34;,      &#34;utag_main_dc_region&#34;: &#34;us-east-1&#34;,      &#34;utag_main__st&#34;: &#34;1609913306118&#34;,      &#34;utag_main_v_id&#34;: &#34;0176cb4f3482110a5ba4702e147b0006d005a065104f2&#34;,      &#34;utag_main__se&#34;: &#34;66&#34;,      &#34;utag_main__ss&#34;: &#34;0&#34;,      &#34;utag_main_dc_event&#34;: &#34;60&#34;,      &#34;utag_main__pn&#34;: &#34;5&#34;    }  },  &#34;env&#34;: &#34;prod&#34;,  &#34;post_time&#34;: 1537305808000}</code></pre><p>Event data can be accessed in a function as follows:</p><pre tabindex=\"0\"><code>const data = {};    // DOM variables are stored in event.dom    data.current_url = event?.dom?.url;    // Standard UDO event variables are stored in event.data.udo    data.session_id = event?.data?.udo?.tealium_session_id;    // First Party cookies are stored in event.firstparty_tealium_cookies    data.trace_id = event?.firstparty_tealium_cookies?.trace_id;    // Meta variables are stored in event.meta    data.meta_description = event?.meta?.description;    data.tealium_event = event?.data?.udo?.tealium_event;    data.tealium_account = event?.data?.udo?.tealium_account;    data.tealium_profile = event?.data?.udo?.tealium_profile;</code></pre><h3 id=\"visitor-object\">Visitor object</h3><p>The <code>visitor</code> object is available when a function is triggered by the audience feed and contains the visitor data.</p><table><thead><tr><th><strong>Property</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>visitor.metrics</code></td><td>Record&lt;string, number&gt;</td><td>Visitor metrics.</td></tr><tr><td><code>visitor.metrics_sets</code></td><td>Tally&lt;string, number&gt;</td><td></td></tr><tr><td><code>visitor.dates</code></td><td>Record&lt;string, number&gt;</td><td>Visitor dates.</td></tr><tr><td><code>visitor.audiences_joined_at</code></td><td>Record&lt;string, number&gt;</td><td>Timestamp when the visitor joined audiences.</td></tr><tr><td><code>visitor.properties</code></td><td>Record&lt;string, any&gt;</td><td>Visitor properties.</td></tr><tr><td><code>visitor.properties.account</code></td><td>string</td><td>Tealium Account.</td></tr><tr><td><code>visitor.properties.profile</code></td><td>string</td><td>Tealium Profile.</td></tr><tr><td><code>visitor.properties.visitor_id</code></td><td>string</td><td>Tealium Visitor ID.</td></tr><tr><td><code>visitor.property_sets</code></td><td>Set&lt;string, any&gt;</td><td></td></tr><tr><td><code>visitor.audiences</code></td><td>string[]</td><td>List of joined audiences.</td></tr><tr><td><code>visitor.badges</code></td><td>string[]</td><td>List of badges.</td></tr><tr><td><code>visitor.creation_ts</code></td><td>number</td><td>Visitor creation timestamp.</td></tr><tr><td><code>visitor.flags</code></td><td>Map&lt;string, Boolean&gt;</td><td></td></tr><tr><td><code>visitor.current_visit</code></td><td>Record&lt;string, any&gt;</td><td>Current visit object.</td></tr><tr><td><code>visitor.current_visit.metrics</code></td><td>Record&lt;string, number&gt;</td><td>Current visit metrics.</td></tr><tr><td><code>visitor.current_visit.metrics_sets</code></td><td>Tally&lt;string, number&gt;</td><td></td></tr><tr><td><code>visitor.current_visit.dates</code></td><td>Record&lt;string, number&gt;</td><td>Current visit dates.</td></tr><tr><td><code>visitor.current_visit.properties</code></td><td>Record&lt;string, any&gt;</td><td>Current visit properties.</td></tr><tr><td><code>visitor.current_visit.flags</code></td><td>Map&lt;string, Boolean&gt;</td><td>Current visit flags.</td></tr><tr><td><code>visitor.current_visit.property_sets</code></td><td>Set&lt;string, any&gt;</td><td>Current visit property sets.</td></tr><tr><td><code>visitor.current_visit.creation_ts</code></td><td>number</td><td>Current visit creation timestamp.</td></tr><tr><td><code>visitor.current_visit.total_event_count</code></td><td>number</td><td>Current visit total event count.</td></tr><tr><td><code>visitor.current_visit.events_compressed</code></td><td>boolean</td><td>Current visit events compressed.</td></tr></tbody></table><h4 id=\"visitor-object-example\">Visitor object example</h4><p>The following is an example of visitor object data:</p><pre tabindex=\"0\"><code>{  &#34;metrics&#34;: {    &#34;Metric 1&#34;: 1,    &#34;Metric 2&#34;: 2  },  &#34;dates&#34;: {    &#34;Date 1&#34;: 1603373790000,    &#34;Date 2&#34;: 1603373522000,  },  &#34;properties&#34;: {    &#34;profile&#34;: &#34;username&#34;,    &#34;visitor_id&#34;: &#34;017560818b67001bc185a07f1cd703078003405000b7e&#34;,    &#34;account&#34;: &#34;user-account&#34;,  },  &#34;audiences&#34;: [    &#34;Audience 1&#34;,    &#34;Audience 2&#34;  ],  &#34;badges&#34;: [    &#34;Badge 1&#34;,    &#34;Badge 2&#34;  ],  &#34;creation_ts&#34;: 1603373522000,  &#34;current_visit&#34;: {    &#34;metrics&#34;: {      &#34;Metric 1&#34;: 1.3,      &#34;Metric 2&#34;: 6,    },    &#34;dates&#34;: {      &#34;Date 1&#34;: 1603373868000,      &#34;Date 2&#34;: 1603373790000,    },    &#34;properties&#34;: {      &#34;Property 1&#34;: &#34;Chrome&#34;,      &#34;Property 2&#34;: &#34;https://URL-for-website &#34;,    },    &#34;flags&#34;: {      &#34;Flag 1&#34;: true,      &#34;Flag 2&#34;: false    },    &#34;property_sets&#34;: {      &#34;Property Set 1&#34;: [        &#34;Mac desktop&#34;      ],      &#34;Property Set 2&#34;: [        &#34;Chrome&#34;      ]    },    &#34;creation_ts&#34;: 1603373790000,    &#34;total_event_count&#34;: 2,    &#34;events_compressed&#34;: false  },  &#34;audiences_joined_at&#34;: {    &#34;Audience 1&#34;: 1603363523014,    &#34;Audience 2&#34;: 1603363523014  }}</code></pre><h2 id=\"auth-object-authget\">Auth object: auth.get()</h2><p>Functions require authentication to access some service providers, such as Facebook or Google. For more information, see <a href=\"/server-side/functions/event-visitor-functions/authentication/\">Adding an Authentication to a Function</a>. When you add an authentication, an access token is returned.</p><p>The <code>auth.get()</code> method returns a string that contains a unique auto-generated ID for the authentication token. When a function makes an HTTP request using this token ID, it is automatically replaced with the token before the request is sent.</p><table><thead><tr><th><strong>Parameter</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>authName</td><td>string</td><td>Specifies the name of the authentication, which is the name entered when the authentication was added to the function.</td></tr></tbody></table><p>The following example shows how to use <code>auth.get()</code> to get the token ID:</p><pre tabindex=\"0\"><code>console.log(auth.get(&#34;TEST_AUTH&#34;));</code></pre><h2 id=\"tealium-object-sendcollectevent\">Tealium object: sendCollectEvent()</h2><p>The <code>sendCollectEvent()</code> method sends an event to Tealium Collect HTTP API and returns a string.</p><table><thead><tr><th><strong>Parameter</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>event</td><td>EventsClientEventObject</td><td>An event object to send to Tealium Collect HTTP API.</td></tr><tr><td>account</td><td>string</td><td>Optional. If specified, replaces the value of event.tealium_account.</td></tr><tr><td>profile</td><td>string</td><td>Optional. If specified, replaces the value of event.tealium_profile.</td></tr><tr><td>dataSourceId</td><td>string</td><td>Optional. If specified, replaces the value of event.tealium_datasource.</td></tr></tbody></table><p>The <code>Response</code> interface of the Tealium Collect HTTP API represents the response to a request. The <code>Response</code> model is the same as for <code>fetch</code> API, except that the URL is not available in the result from the collect client.</p><h3 id=\"sending-an-event-to-tealium-collect\">Sending an event to Tealium Collect</h3><p>The following example shows how to send an event to the Tealium Collect HTTP API.</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">import</span> {<span style=\"color:#a6e22e\">event</span>, <span style=\"color:#a6e22e\">tealium</span>} <span style=\"color:#a6e22e\">from</span> <span style=\"color:#e6db74\">&#39;tealium&#39;</span>;</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">var</span> <span style=\"color:#a6e22e\">newEvent</span> <span style=\"color:#f92672\">=</span> {<span style=\"color:#960050;background-color:#1e0010\">‘</span><span style=\"color:#a6e22e\">key</span><span style=\"color:#960050;background-color:#1e0010\">’</span><span style=\"color:#f92672\">:</span> <span style=\"color:#960050;background-color:#1e0010\">‘</span><span style=\"color:#a6e22e\">value</span><span style=\"color:#960050;background-color:#1e0010\">’</span>};</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">tealium</span>.<span style=\"color:#a6e22e\">sendCollectEvent</span>(<span style=\"color:#a6e22e\">newEvent</span>, <span style=\"color:#e6db74\">&#39;newAccount&#39;</span>, <span style=\"color:#e6db74\">&#39;newProfile&#39;</span>, <span style=\"color:#e6db74\">&#39;datasourceId&#39;</span>)</span></span><span style=\"display:flex;\"><span>    .<span style=\"color:#a6e22e\">then</span>(<span style=\"color:#a6e22e\">response</span> =&gt; {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#66d9ef\">if</span> (<span style=\"color:#f92672\">!</span><span style=\"color:#a6e22e\">response</span>.<span style=\"color:#a6e22e\">ok</span>) {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#66d9ef\">throw</span> <span style=\"color:#66d9ef\">new</span> Error(<span style=\"color:#e6db74\">`Network response was not ok. Status code: </span><span style=\"color:#e6db74\">${</span><span style=\"color:#a6e22e\">response</span>.<span style=\"color:#a6e22e\">status</span><span style=\"color:#e6db74\">}</span><span style=\"color:#e6db74\">.`</span>);</span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#e6db74\">&#39;Status code:&#39;</span>, <span style=\"color:#a6e22e\">response</span>.<span style=\"color:#a6e22e\">status</span>);</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#66d9ef\">return</span> <span style=\"color:#a6e22e\">response</span>.<span style=\"color:#a6e22e\">text</span>();</span></span><span style=\"display:flex;\"><span>    })</span></span><span style=\"display:flex;\"><span>    .<span style=\"color:#a6e22e\">then</span>(<span style=\"color:#a6e22e\">data</span> =&gt; <span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#e6db74\">&#39;Result:&#39;</span>, <span style=\"color:#a6e22e\">data</span>))</span></span><span style=\"display:flex;\"><span>    .<span style=\"color:#66d9ef\">catch</span>(<span style=\"color:#a6e22e\">error</span> =&gt; <span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">error</span>(<span style=\"color:#e6db74\">&#39;Error:&#39;</span>, <span style=\"color:#a6e22e\">error</span>.<span style=\"color:#a6e22e\">message</span>));</span></span></code></pre></div><h2 id=\"store-object-storeget\">Store object: store.get()</h2><p>The <code>store</code> object contains key/value pairs, referred to as global variables, that specify variables or constants that can be used in multiple functions. Global variables can be added, edited, and deleted from the <strong>Code</strong> tab of the functions code editor. Functions can retrieve the value of a global variable, but cannot modify it.</p><p>Functions can retrieve a value for a key by calling the <code>store.get()</code> method and passing the key as the parameter. For more information on adding and editing global variables, see <a href=\"/server-side/functions/manage-functions/manage-global-variables/\">Manage global variables</a>.</p><table><thead><tr><th><strong>Parameter</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td>globalParameterKey</td><td>string</td><td>Specifies the key of the global variable to get.</td></tr></tbody></table><p>For example, if you create a global variable with a key named <code>date</code>, a function would retrieve the value for <code>date</code> as follows:</p><p><code>store.get('date')</code></p><h2 id=\"getting-an-attribute-name-or-attribute-value-by-attribute-id\">Getting an attribute name or attribute value by attribute ID</h2><p>Attribute names can be changed, which can cause problems when code references attributes by name. To avoid problems with attribute names changing, you can reference attributes by ID. Event and visitor objects have a <code>getAttributeNameById()</code> method that you can use to get an attribute name based on its ID. You can also get the value of an attribute using the <code>getAttributeValueById()</code> method. The following example shows how this works.</p><p>If you enter the following in the code editor, when you enter the opening parenthesis, a list of attributes and associated IDs is displayed: <figure><a class=\"slb\" href=\"/images/server-side/functions-code-completion-attr-name.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-code-completion-attr-name.png\"         alt=\"code completion attribute name\"         title=\"code completion attribute name\"/>    </a></figure></p><p>You can enter part of the attribute name to filter the list. When you select an attribute, its ID is added to your code after the parenthesis. The list of attributes works the same way for <code>getAttributeValueById()</code>.</p><h2 id=\"using-the-fetch-api-to-make-http-requests\">Using the fetch() API to make HTTP requests</h2><p>The fetch API is available for functions to make HTTP requests, as shown in the following example. For more information, see <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch\">Fetch</a>.</p><pre tabindex=\"0\"><code>fetch(&#39;https://restcountries.eu/rest/v2/name/usa&#39;)  .then(response =&gt; {    if (!response.ok) {      throw new Error(`Network response was not ok. Status code: ${response.status}.`);    }    return response.json();  })  .then(data =&gt; console.log(&#39;Capital:&#39;, data[0].capital))  .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><p>The following example shows fetching a resource from the network, returning a promise that is fulfilled when the response is available.</p><pre tabindex=\"0\"><code>const fetchResponsePromise = fetch(resource [, init])</code></pre><p>The Request interface of the Fetch API represents a resource request and is defined as follows:</p><pre tabindex=\"0\"><code>const myRequest = new Request(input[, init]);</code></pre><p>Functions can use the Headers interface of the Fetch API to perform various actions on HTTP request and response headers. Headers() is defined as follows:</p><pre tabindex=\"0\"><code>const myHeaders = new Headers(init);</code></pre><p>The Response interface of the Fetch API represents the response to a request and is defined as follows:</p><pre tabindex=\"0\"><code>const myResponse = new Response(body, init);</code></pre><p>The following browser-specific functionality is not supported:</p><ul><li>cache</li><li>credentials</li><li>referrer</li><li>referrerPolicy</li><li>signal</li><li>keepalive</li><li>redirect</li><li>mode</li></ul><h2 id=\"using-urlsearchparams-methods-to-build-a-url-query-string\">Using URLSearchParams methods to build a URL query string</h2><p>The URLSearchParams interface defines utility methods to work with the query string of a URL. This example shows using URLSearchParams to build a query string for a URL.</p><pre tabindex=\"0\"><code>function jsonToURLSearchParams(data) {    const params = new URLSearchParams();    buildURLSearchParams(params, data);    return params;}function buildURLSearchParams(params, data, parentKey) {    if (data &amp;&amp; typeof data === &#39;object&#39; &amp;&amp; !(data instanceof Date)) {        Object.keys(data).forEach(key =&gt; {            buildURLSearchParams(params, data[key], parentKey ? `${parentKey}[${key}]` : key);        });    } else {        const value = data == null ? &#39;&#39; : data;        params.append(parentKey, value);    }}</code></pre>"
        }  

    , 
        {
            "weight": "25",
            "url": "https://docs.tealium.com/server-side/functions/modules/",
            "title": "APIs and libraries for functions",
            "body":"<p>Functions can use the following APIs and libraries:</p><ul><li>Crypto-ES.js</li><li>TweetNaCl.js</li><li>JavaScript Console API</li></ul><h2 id=\"crypto-esjs\">Crypto-ES.js</h2><p>Crypto-ES.js is a library of encryption algorithms available that provides hashing, encoding, and cipher algorithms. For more information, see <a href=\"https://www.npmjs.com/package/crypto-es/v/1.2.7\">Crypto-ES</a>.</p><p>The following example shows how to encrypt and decrypt text:</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">import</span> <span style=\"color:#a6e22e\">CryptoES</span> <span style=\"color:#a6e22e\">from</span> <span style=\"color:#e6db74\">&#39;crypto-es&#39;</span>;</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">var</span> <span style=\"color:#a6e22e\">encrypted</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">CryptoES</span>.<span style=\"color:#a6e22e\">AES</span>.<span style=\"color:#a6e22e\">encrypt</span>(<span style=\"color:#e6db74\">&#34;Message&#34;</span>, <span style=\"color:#e6db74\">&#34;Secret Passphrase&#34;</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#a6e22e\">encrypted</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">var</span> <span style=\"color:#a6e22e\">decrypted</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">CryptoES</span>.<span style=\"color:#a6e22e\">AES</span>.<span style=\"color:#a6e22e\">decrypt</span>(<span style=\"color:#a6e22e\">encrypted</span>, <span style=\"color:#e6db74\">&#34;Secret Passphrase&#34;</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#a6e22e\">CryptoES</span>.<span style=\"color:#a6e22e\">enc</span>.<span style=\"color:#a6e22e\">Utf8</span>.<span style=\"color:#a6e22e\">stringify</span>(<span style=\"color:#a6e22e\">decrypted</span>));</span></span></code></pre></div><h2 id=\"tweetnacljs\">TweetNaCl.js</h2><p>TweetNaCl is a crypto library that implements secret-key authenticated encryption, public-key authenticated encryption, and hashing and public-key signatures. The TweetNaCl library is available only for event and visitor functions.</p><p>Import the TweetNaCl.js module into your event or visitor function as follows:</p><p><code>import nacl from 'tweetnacl';</code></p><p>For more information, see <a href=\"https://www.npmjs.com/package/tweetnacl\">NPM TweetNaCl.js</a>.</p><h2 id=\"javascript-console-api\">JavaScript console API</h2><p>Use the JavaScript console functions to write messages and errors to the log.</p><p><code>console.log()</code> , <code>console.info(),</code> and <code>console.debug()</code> log messages go to the info output stream. <code>console.warn()</code> and <code>console.error()</code> log messages go to the error output stream.</p><p class=\"note\"><i class=\"fa fa-exclamation-triangle\"></i>The info and error output streams are each limited to 10 Kb of data per function invocation. If log messages exceed this limit, the log file will contain the first 10 Kb of data and end with the following message:<br><code>Output was too large and has been truncated.</code></p><p>The console object provides other methods that are supported by functions. For more information, refer to any JavaScript <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Console\" title=\"https://developer.mozilla.org/en-US/docs/Web/API/Console\">specification</a> for the console object. The following additional console methods are supported:</p><ul><li><code>assert()</code></li><li><code>count()</code></li><li><code>countReset()</code></li><li><code>group()</code></li><li><code>groupEnd()</code></li><li><code>time()</code></li><li><code>timeEnd()</code></li><li><code>timeLog()</code></li></ul><h3 id=\"console-api-output\">Console API output</h3><p>The output from most console functions is shown in the <strong>Messages</strong> section of the <strong>Logs</strong> display. For example:</p><pre tabindex=\"0\"><code>Messages:Function Start</code></pre><p>Output from <code>console.warn()</code> and <code>console.error()</code> is shown in the <strong>Errors</strong> section, below the <strong>Messages</strong> output, as follows:</p><pre tabindex=\"0\"><code>Errors:Warning - page not foundError - variable not defined</code></pre><h3 id=\"consoleassert\">console.assert()</h3><p>If a function is triggered on EventStream and <code>console.assert()</code> is called as follows:</p><pre tabindex=\"0\"><code>console.assert(visitor, &#34;visitor not defined&#34;);</code></pre><p>The <code>visitor</code> object is only defined when the trigger is AudienceStream, so the assertion is false and the output is as follows:</p><pre tabindex=\"0\"><code>Assertion failed: visitor not defined</code></pre><h3 id=\"consolegroup-and-consolegroupend\">console.group() and console.groupEnd()</h3><p><code>console.group()</code> and <code>console.groupEnd() </code> can be used to format related messages in the log. <code>console.log()</code> messages that follow <code>console.group()</code> are indented in the log. The indentation ends after <code>console.groupEnd()</code> is called.</p><p>If the function code contains the following:</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">group</span>(<span style=\"color:#e6db74\">&#34;Event info:&#34;</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#e6db74\">&#34;Account: &#34;</span>, <span style=\"color:#a6e22e\">event</span>.<span style=\"color:#a6e22e\">account</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">log</span>(<span style=\"color:#e6db74\">&#34;Visitor ID: &#34;</span>, <span style=\"color:#a6e22e\">event</span>.<span style=\"color:#a6e22e\">visitor_id</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">console</span>.<span style=\"color:#a6e22e\">groupEnd</span>();</span></span></code></pre></div><p>The output is as follows:</p><pre tabindex=\"0\"><code>Event info:  Account:  Acme Mfg  Visitor ID:  017407a1d9e50019633c3cea732703079011607100bd6</code></pre><h3 id=\"consoletime-and-consoletimelog\">console.time() and console.timeLog()</h3><p>When a function calls <code>console.time()</code>, there is no output. The time that <code>console.time()</code> was called with that string is noted. When <code>console.timeLog()</code> is called with the same string, <code>&quot;Current Time: &quot;</code> in this example, the output is the specified string followed by the time elapsed since <code>console.time()</code> was called:</p><pre tabindex=\"0\"><code>Current Time: : 1ms</code></pre><p>After a function calls <code>console.timeEnd()</code>, <code>console.timeLog()</code> cannot be called until <code>console.time()</code> is called again.</p><h3 id=\"consolecount-and-consolecountreset\">console.count() and console.countReset()</h3><p>Each time <code>console.count()</code> is called with the same string, the count is incremented. The output of <code>console.count()</code> is the string followed by the count. If <code>console.count(&quot;Current count: &quot;); </code> is called twice, the output is as follows:</p><pre tabindex=\"0\"><code>Current count: : 1Current count: : 2</code></pre><p><code>console.countReset()</code> resets the count for the specified string to zero.</p>"
        }  

    , 
        {
            "weight": "30",
            "url": "https://docs.tealium.com/server-side/functions/best-practices/",
            "title": "Functions best practices",
            "body":"<h2 id=\"run-tests-to-determine-execution-time\">Run tests to determine execution time</h2><p>Data transformation functions are limited to 150 ms of execution time. Event and visitor functions are limited to 10 seconds of execution time.</p><p>There are a lot of factors that affect function execution time. To verify that a function can execute in the allowed time, run several tests with the expected event payload.</p><h2 id=\"normalize-the-universal-data-object-udo\">Normalize the universal data object (UDO)</h2><p>The data layer contains basic information about the page where the event occurred. The UDO is a more dynamic structure that contains information for specific event type, which means the size of the event may vary. The recommended maximum event size is 50 KB. To keep the data compact, remove redundant data entries. If the same data occurs in multiple fields (for example, in the data layer and in the UDO), it is a candidate for removal from the UDO. If a chunk of data is not required for a particular event type, it is also a candidate for removal from the event UDO.</p><h2 id=\"use-partial-import-for-standard-modules\">Use partial import for standard modules</h2><p>The execution environment provides standard modules that support partial import, including CryptoES.</p><p>Import only the required functionality for a module, instead of importing the entire module. For example:</p><pre tabindex=\"0\"><code>import { MD5 } from &#39;crypto-es/lib/md5.js&#39;;</code></pre><h2 id=\"avoid-the-use-of-debugging-log-messages\">Avoid the use of debugging log messages</h2><p>Before publishing a function to your production environment, remove or comment out <code>console.log</code> messages that are used for debugging purposes.</p><p>For example, avoid using <code>JSON.stringify</code> to send the entire event to the log. Use log messages for specific variables instead, as shown in the following example:</p><pre tabindex=\"0\"><code>console.log(event.data.udo.property_to_track);</code></pre><h2 id=\"use-the-flatten-built-in-module\">Use the flatten() built-in module</h2><p>The built-in <code>flatten()</code> module can be used to flatten any nested object, which is particularly useful for data transformation functions. Transformation functions can work with nested data structures, such as arrays of objects or nested objects, but need to flatten the incoming event so that it does not contain nested data structures.</p><h2 id=\"use-javascript-optimizations\">Use JavaScript optimizations</h2><p>Use JavaScript optimizations for intensive tasks, such as iterating over an array or object properties.</p><h3 id=\"example-of-iterating-over-an-array\">Example of iterating over an array</h3><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">array</span> <span style=\"color:#f92672\">=</span> [<span style=\"color:#ae81ff\">1</span>, <span style=\"color:#ae81ff\">2</span>, <span style=\"color:#ae81ff\">3</span>];</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">arrayLength</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">array</span>.<span style=\"color:#a6e22e\">length</span>;</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">for</span> (<span style=\"color:#66d9ef\">let</span> <span style=\"color:#a6e22e\">i</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span>; <span style=\"color:#a6e22e\">i</span> <span style=\"color:#f92672\">&lt;</span> <span style=\"color:#a6e22e\">arrayLength</span>; <span style=\"color:#a6e22e\">i</span><span style=\"color:#f92672\">++</span>) {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">arrayItem</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">array</span>[<span style=\"color:#a6e22e\">i</span>];</span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div><h3 id=\"example-of-iterating-over-object-properties\">Example of iterating over object properties</h3><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">obj</span> <span style=\"color:#f92672\">=</span> { <span style=\"color:#a6e22e\">a</span><span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">1</span>, <span style=\"color:#a6e22e\">b</span><span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">2</span>, <span style=\"color:#a6e22e\">c</span><span style=\"color:#f92672\">:</span> <span style=\"color:#ae81ff\">3</span> };</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">keys</span> <span style=\"color:#f92672\">=</span> Object.<span style=\"color:#a6e22e\">getOwnPropertyNames</span>(<span style=\"color:#a6e22e\">obj</span>);</span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">keysLength</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">keys</span>.<span style=\"color:#a6e22e\">length</span>;</span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span><span style=\"color:#66d9ef\">for</span> (<span style=\"color:#66d9ef\">let</span> <span style=\"color:#a6e22e\">i</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#ae81ff\">0</span>; <span style=\"color:#a6e22e\">i</span> <span style=\"color:#f92672\">&lt;</span> <span style=\"color:#a6e22e\">keysLength</span>; <span style=\"color:#a6e22e\">i</span><span style=\"color:#f92672\">++</span>) {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">keyName</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">keys</span>[<span style=\"color:#a6e22e\">i</span>];</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">value</span> <span style=\"color:#f92672\">=</span> <span style=\"color:#a6e22e\">obj</span>[<span style=\"color:#a6e22e\">keyName</span>];</span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div>"
        }  

    , 
        {
            "weight": "30",
            "url": "https://docs.tealium.com/server-side/functions/event-visitor-functions/event-visitor-v3/",
            "title": "Event and visitor functions V3",
            "body":"<h2 id=\"input-data\">Input data</h2><p>The input parameters vary depending on function type, as follows:</p><ul><li>Event functions have an <code>event</code> parameter. The <code>visit</code> and <code>visitor</code> parameters are null.</li><li>Visitor functions have <code>visitor</code>and <code>visit</code> parameters. The <code>event</code> parameter is null.</li></ul><p>Event and visitor functions have additional parameters, <code>helper</code>, which provides <code>helper.getAuth()</code> and <code>helper.getGlobalVariable()</code> for getting authorization and retrieving global variables.</p><h2 id=\"activate-function\">activate() function</h2><p>When you create a V3 event or visitor function, default code is shown in the <strong>Code</strong> tab of the functions code editor. This code contains a global <code>activate</code> function. The input parameters for your function are passed to the <code>activate()</code> function. The following example shows <code>activate()</code> for an event function:</p><pre tabindex=\"0\"><code>activate(async ({ event, helper }) =&gt; {  ...});</code></pre><p>Change the code between the first and last lines of the default code to suit your needs.</p><h3 id=\"event-object\">Event object</h3><p>The <code>event</code> object is available when a function is triggered by the event feed and contains the event data.</p><table><thead><tr><th>Property</th><th>Data Type</th><th>Description</th></tr></thead><tbody><tr><td><code>account</code></td><td>string</td><td>Tealium account.</td></tr><tr><td><code>data</code></td><td>object</td><td>Data layer, which contains event data.</td></tr><tr><td><code>env</code></td><td>string</td><td>Execution environment. Value can be <code>qa</code>, <code>dev</code>, or <code>prod</code>.</td></tr><tr><td><code>event_id</code></td><td>string</td><td>Tealium event ID.</td></tr><tr><td><code>post_time</code></td><td>number</td><td>Timestamp indicating when the event occurred.</td></tr><tr><td><code>profile</code></td><td>string</td><td>Tealium profile.</td></tr><tr><td><code>useragent</code></td><td>string</td><td>A string that represents the user agent, such as the browser.</td></tr><tr><td><code>visitor_id</code></td><td>string</td><td>Tealium visitor ID.</td></tr><tr><td><code>function getAttributeNameById(id)</code></td><td>string</td><td>Returns a string containing the name of the specified attribute. <code>id</code> is a string that specifies the attribute ID.</td></tr><tr><td><code>function getAttributeValueById(id)</code></td><td>any</td><td>Returns the value of the specified attribute. <code>id</code> is a string that specifies the attribute ID.</td></tr></tbody></table><h4 id=\"data-object\">Data object</h4><p>The <code>data</code> object contains the data for the incoming event.</p><table><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>dom</code></td><td>Object</td><td>Standard page data.</td></tr><tr><td><code>firstparty_tealium_cookies</code></td><td>Object</td><td>All the cookies from the browser.</td></tr><tr><td><code>js</code></td><td>Object</td><td>JavaScript variables from the page.</td></tr><tr><td><code>meta</code></td><td>Object</td><td>Data from the meta tags on the web page.</td></tr><tr><td><code>udo</code></td><td>Object</td><td>Universal Data Object that contains the properties of the incoming event.</td></tr></tbody></table><h4 id=\"event-object-example\">Event object example</h4><p>The following shows an example of event object data:</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-json\" data-lang=\"json\"><span style=\"display:flex;\"><span>{</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;account&#34;</span>: <span style=\"color:#e6db74\">&#34;your-account&#34;</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;profile&#34;</span>: <span style=\"color:#e6db74\">&#34;main&#34;</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;event_id&#34;</span>: <span style=\"color:#e6db74\">&#34;run-test-event-id&#34;</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;visitor_id&#34;</span>: <span style=\"color:#e6db74\">&#34;run-test-visitor-id&#34;</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;data&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;dom&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;viewport_height&#34;</span>: <span style=\"color:#ae81ff\">766</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;referrer&#34;</span>: <span style=\"color:#e6db74\">&#34;&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;viewport_width&#34;</span>: <span style=\"color:#ae81ff\">1440</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;domain&#34;</span>: <span style=\"color:#e6db74\">&#34;www.example.com&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;title&#34;</span>: <span style=\"color:#e6db74\">&#34;Home Page&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;query_string&#34;</span>: <span style=\"color:#e6db74\">&#34;q=help&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;hash&#34;</span>: <span style=\"color:#e6db74\">&#34;&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;url&#34;</span>: <span style=\"color:#e6db74\">&#34;https://www.example.com/?q=help&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;pathname&#34;</span>: <span style=\"color:#e6db74\">&#34;/&#34;</span></span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;udo&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_event&#34;</span>: <span style=\"color:#e6db74\">&#34;page_view&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.account&#34;</span>: <span style=\"color:#e6db74\">&#34;your-account&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.visitor_id&#34;</span>: <span style=\"color:#e6db74\">&#34;0176cb4f3482110a5ba4702e147b0006d005a065104f2&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;page_name&#34;</span>: <span style=\"color:#e6db74\">&#34;Home Page&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.event&#34;</span>: <span style=\"color:#e6db74\">&#34;view&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;search_keyword&#34;</span>: <span style=\"color:#e6db74\">&#34;help&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.domain&#34;</span>: <span style=\"color:#e6db74\">&#34;example.com&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_profile&#34;</span>: <span style=\"color:#e6db74\">&#34;main&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.version&#34;</span>: <span style=\"color:#e6db74\">&#34;ut4.46.202006020705&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_session_id&#34;</span>: <span style=\"color:#e6db74\">&#34;1609910608323&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;tealium_account&#34;</span>: <span style=\"color:#e6db74\">&#34;your-account&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;ut.profile&#34;</span>: <span style=\"color:#e6db74\">&#34;main&#34;</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;firstparty_tealium_cookies&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main__sn&#34;</span>: <span style=\"color:#e6db74\">&#34;12&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main_dc_visit&#34;</span>: <span style=\"color:#e6db74\">&#34;12&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main_ses_id&#34;</span>: <span style=\"color:#e6db74\">&#34;1609910610822&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main_dc_region&#34;</span>: <span style=\"color:#e6db74\">&#34;us-east-1&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main__st&#34;</span>: <span style=\"color:#e6db74\">&#34;1609913306118&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main_v_id&#34;</span>: <span style=\"color:#e6db74\">&#34;0176cb4f3482110a5ba4702e147b0006d005a065104f2&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main__se&#34;</span>: <span style=\"color:#e6db74\">&#34;66&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main__ss&#34;</span>: <span style=\"color:#e6db74\">&#34;0&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main_dc_event&#34;</span>: <span style=\"color:#e6db74\">&#34;60&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;utag_main__pn&#34;</span>: <span style=\"color:#e6db74\">&#34;5&#34;</span></span></span><span style=\"display:flex;\"><span>    }</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;env&#34;</span>: <span style=\"color:#e6db74\">&#34;prod&#34;</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;post_time&#34;</span>: <span style=\"color:#ae81ff\">1537305808000</span></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div><h2 id=\"visitor-object\">Visitor object</h2><p>The <code>visitor</code> object is available when a function is triggered by the audience feed and contains the visitor data.</p><table><thead><tr><th><strong>Property</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>badges</code></td><td>string[]</td><td>Badge attributes.</td></tr><tr><td><code>metrics</code></td><td>object(key, number)</td><td>Number attributes.</td></tr><tr><td><code>properties</code></td><td>object(key, string)</td><td>String attributes.</td></tr><tr><td><code>dates</code></td><td>object(key, epoch)</td><td>Dates attributes in epoch format.</td></tr><tr><td><code>flags</code></td><td>object(key, boolean)</td><td>Boolean attributes.</td></tr><tr><td><code>metrics_sets</code></td><td>object(key, object(key, number))</td><td>Tally attributes.</td></tr><tr><td><code>property_sets</code></td><td>object(key, string[])</td><td>Set of strings attributes.</td></tr><tr><td><code>funnels</code></td><td>object (see example)</td><td>Funnel attributes.</td></tr><tr><td><code>sequences</code></td><td>object (see example)</td><td>Timeline attributes.</td></tr><tr><td><code>property_lists</code></td><td>object(key, string[])</td><td>Array of string attributes.</td></tr><tr><td><code>metric_lists</code></td><td>object(key, number[])</td><td>Array of numbers attributes.</td></tr><tr><td><code>flag_lists</code></td><td>object(key, boolean[])</td><td>Array of booleans attributes.</td></tr><tr><td><code>secondary_ids</code></td><td>string</td><td>User identifiers such as email address, social media ID, or customer ID.</td></tr><tr><td><code>audiences</code></td><td>string[]</td><td>Audiences that the visitor is currently in.</td></tr><tr><td><code>creation_ts</code></td><td>epoch</td><td>Visitor creation timestamp.</td></tr><tr><td><code>new_visitor</code></td><td>boolean</td><td>Indicates whether this is a new visitor.</td></tr><tr><td><code>audiences_joined_at</code></td><td>number</td><td>Timestamps for when the visitor joined audiences.</td></tr><tr><td><code>current_visit</code></td><td>visit object</td><td>Data for the current visit.</td></tr><tr><td><code>function getAttributeNameById(id)</code></td><td>string</td><td>Returns a string containing the name of the specified attribute ID. <code>id</code> is a string that contains the attribute ID.</td></tr><tr><td><code>function getAttributeValueById(id)</code></td><td>any</td><td>Returns the value of the specified attribute ID. <code>id</code> is a string that contains the attribute ID.</td></tr></tbody></table><h3 id=\"visitor-object-example\">Visitor object example</h3><p>The following is an example of <code>visitor</code> object data:</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-json\" data-lang=\"json\"><span style=\"display:flex;\"><span>{</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;metrics&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Metric 1&#34;</span>: <span style=\"color:#ae81ff\">1</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Metric 2&#34;</span>: <span style=\"color:#ae81ff\">2</span></span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;dates&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Date 1&#34;</span>: <span style=\"color:#ae81ff\">1603373790000</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Date 2&#34;</span>: <span style=\"color:#ae81ff\">1603373522000</span>,</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;properties&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;profile&#34;</span>: <span style=\"color:#e6db74\">&#34;username&#34;</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;visitor_id&#34;</span>: <span style=\"color:#e6db74\">&#34;017560818b67001bc185a07f1cd703078003405000b7e&#34;</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;account&#34;</span>: <span style=\"color:#e6db74\">&#34;user-account&#34;</span>,</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;metrics_sets&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Product Categories Purchased&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Shoes&#34;</span>: <span style=\"color:#ae81ff\">1</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Pants&#34;</span>: <span style=\"color:#ae81ff\">3</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Shirts&#34;</span>: <span style=\"color:#ae81ff\">7</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Shorts&#34;</span>: <span style=\"color:#ae81ff\">2</span></span></span><span style=\"display:flex;\"><span>    }</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;sequences&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Hotel Search Timeline&#34;</span>: [</span></span><span style=\"display:flex;\"><span>      {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681858801598</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Paradise Island&#34;</span></span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      },</span></span><span style=\"display:flex;\"><span>      {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681860398985</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Skokie&#34;</span></span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      },</span></span><span style=\"display:flex;\"><span>      {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681860423335</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Las Vegas&#34;</span></span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      }</span></span><span style=\"display:flex;\"><span>    ]</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;funnels&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Purchase Funnel&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;completed&#34;</span>: <span style=\"color:#66d9ef\">true</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;steps&#34;</span>: {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;1&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624226</span>,</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;product_name&#34;</span>: <span style=\"color:#e6db74\">&#34;Skinny Jeans&#34;</span></span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        },</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;2&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624227</span>,</span></span><span style=\"display:flex;\"><span>        },</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;3&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624228</span>,</span></span><span style=\"display:flex;\"><span>        },</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;4&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624229</span>,</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;order_id&#34;</span>: <span style=\"color:#e6db74\">&#34;0123456789&#34;</span>,</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;order_total&#34;</span>: <span style=\"color:#e6db74\">&#34;34.98&#34;</span></span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      }</span></span><span style=\"display:flex;\"><span>    }</span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;audiences&#34;</span>: [</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#e6db74\">&#34;Audience 1&#34;</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#e6db74\">&#34;Audience 2&#34;</span></span></span><span style=\"display:flex;\"><span>  ],</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;badges&#34;</span>: [</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#e6db74\">&#34;Badge 1&#34;</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#e6db74\">&#34;Badge 2&#34;</span></span></span><span style=\"display:flex;\"><span>  ],</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;creation_ts&#34;</span>: <span style=\"color:#ae81ff\">1603373522000</span>,</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;current_visit&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;metrics&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Metric 1&#34;</span>: <span style=\"color:#ae81ff\">1.3</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Metric 2&#34;</span>: <span style=\"color:#ae81ff\">6</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;dates&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Date 1&#34;</span>: <span style=\"color:#ae81ff\">1603373868000</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Date 2&#34;</span>: <span style=\"color:#ae81ff\">1603373790000</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;properties&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property 1&#34;</span>: <span style=\"color:#e6db74\">&#34;Chrome&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property 2&#34;</span>: <span style=\"color:#e6db74\">&#34;https://URL-for-website &#34;</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;flags&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Flag 1&#34;</span>: <span style=\"color:#66d9ef\">true</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Flag 2&#34;</span>: <span style=\"color:#66d9ef\">false</span></span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;property_sets&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property Set 1&#34;</span>: [</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#e6db74\">&#34;Mac desktop&#34;</span></span></span><span style=\"display:flex;\"><span>      ],</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property Set 2&#34;</span>: [</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#e6db74\">&#34;Chrome&#34;</span></span></span><span style=\"display:flex;\"><span>      ]</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;creation_ts&#34;</span>: <span style=\"color:#ae81ff\">1603373790000</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;total_event_count&#34;</span>: <span style=\"color:#ae81ff\">2</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;events_compressed&#34;</span>: <span style=\"color:#66d9ef\">false</span></span></span><span style=\"display:flex;\"><span>  },</span></span><span style=\"display:flex;\"><span>  <span style=\"color:#f92672\">&#34;audiences_joined_at&#34;</span>: {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Audience 1&#34;</span>: <span style=\"color:#ae81ff\">1603363523014</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;Audience 2&#34;</span>: <span style=\"color:#ae81ff\">1603363523014</span></span></span><span style=\"display:flex;\"><span>  }</span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div><h2 id=\"visit-object\">Visit object</h2><p>The <code>visit</code> object is available when a function is triggered by the audience feed and contains the data for the current visit.</p><table><thead><tr><th><strong>Property</strong></th><th><strong>Data Type</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>metrics</code></td><td>object(key, number)</td><td>Number attributes.</td></tr><tr><td><code>properties</code></td><td>object(key, string)</td><td>String attributes.</td></tr><tr><td><code>dates</code></td><td>object(key, epoch)</td><td>Dates attributes in epoch format.</td></tr><tr><td><code>flags</code></td><td>object(key, boolean)</td><td>Boolean attributes.</td></tr><tr><td><code>metrics_sets</code></td><td>object(key, object(key, number))</td><td>Tally attributes.</td></tr><tr><td><code>property_sets</code></td><td>object(key, string[])</td><td>Set of strings attributes.</td></tr><tr><td><code>funnels</code></td><td>object (see example)</td><td>Funnel attributes.</td></tr><tr><td><code>sequences</code></td><td>object (see example)</td><td>Timeline attributes.</td></tr><tr><td><code>property_lists</code></td><td>object(key, string[])</td><td>Array of string attributes.</td></tr><tr><td><code>metric_lists</code></td><td>object(key, number[])</td><td>Array of number attributes.</td></tr><tr><td><code>flag_lists</code></td><td>object(key, boolean[])</td><td>Array of boolean attributes.</td></tr><tr><td><code>events_compressed</code></td><td>boolean</td><td>Indicates whether events are compressed.</td></tr><tr><td><code>total_event_count</code></td><td>number</td><td>Total number of events.</td></tr><tr><td><code>creation_ts</code></td><td>number</td><td>Visitor creation timestamp.</td></tr><tr><td><code>function getAttributeNameById(id)</code></td><td>string</td><td>Returns a string containing the name of the specified attribute ID. <code>id</code> is a string that contains the attribute ID.</td></tr><tr><td><code>function getAttributeValueById(id)</code></td><td>any</td><td>Returns the value of the specified attribute ID. <code>id</code> is a string that contains the attribute ID.</td></tr></tbody></table><h3 id=\"visit-object-example\">Visit object example</h3><p>The following is an example of <code>visit</code> object data:</p><div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-json\" data-lang=\"json\"><span style=\"display:flex;\"><span>{</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;metrics&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Metric 1&#34;</span>: <span style=\"color:#ae81ff\">1.3</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Metric 2&#34;</span>: <span style=\"color:#ae81ff\">6</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;dates&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Date 1&#34;</span>: <span style=\"color:#ae81ff\">1603373868000</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Date 2&#34;</span>: <span style=\"color:#ae81ff\">1603373790000</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;properties&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property 1&#34;</span>: <span style=\"color:#e6db74\">&#34;Chrome&#34;</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property 2&#34;</span>: <span style=\"color:#e6db74\">&#34;https://URL-for-website &#34;</span>,</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;flags&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Flag 1&#34;</span>: <span style=\"color:#66d9ef\">true</span>,</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Flag 2&#34;</span>: <span style=\"color:#66d9ef\">false</span></span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;metrics_sets&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Product Categories Purchased&#34;</span>: {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;Shoes&#34;</span>: <span style=\"color:#ae81ff\">1</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;Pants&#34;</span>: <span style=\"color:#ae81ff\">3</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;Shirts&#34;</span>: <span style=\"color:#ae81ff\">7</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;Shorts&#34;</span>: <span style=\"color:#ae81ff\">2</span></span></span><span style=\"display:flex;\"><span>      }</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;property_sets&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property Set 1&#34;</span>: [</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#e6db74\">&#34;Mac desktop&#34;</span></span></span><span style=\"display:flex;\"><span>      ],</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Property Set 2&#34;</span>: [</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#e6db74\">&#34;Chrome&#34;</span></span></span><span style=\"display:flex;\"><span>      ]</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;sequences&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Hotel Search Timeline&#34;</span>: [</span></span><span style=\"display:flex;\"><span>        {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681858801598</span>,</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Paradise Island&#34;</span></span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        },</span></span><span style=\"display:flex;\"><span>        {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681860398985</span>,</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Skokie&#34;</span></span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        },</span></span><span style=\"display:flex;\"><span>        {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1681860423335</span>,</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>              <span style=\"color:#f92672\">&#34;Searched Hotel City&#34;</span>: <span style=\"color:#e6db74\">&#34;Las Vegas&#34;</span></span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      ]</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;funnels&#34;</span>: {</span></span><span style=\"display:flex;\"><span>      <span style=\"color:#f92672\">&#34;Purchase Funnel&#34;</span>: {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;completed&#34;</span>: <span style=\"color:#66d9ef\">true</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#f92672\">&#34;steps&#34;</span>: {</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;1&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624226</span>,</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>              <span style=\"color:#f92672\">&#34;product_name&#34;</span>: <span style=\"color:#e6db74\">&#34;Skinny Jeans&#34;</span></span></span><span style=\"display:flex;\"><span>            }</span></span><span style=\"display:flex;\"><span>          },</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;2&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624227</span>,</span></span><span style=\"display:flex;\"><span>          },</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;3&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624228</span>,</span></span><span style=\"display:flex;\"><span>          },</span></span><span style=\"display:flex;\"><span>          <span style=\"color:#f92672\">&#34;4&#34;</span>: {</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;timestamp&#34;</span>: <span style=\"color:#ae81ff\">1636661624229</span>,</span></span><span style=\"display:flex;\"><span>            <span style=\"color:#f92672\">&#34;snapshot&#34;</span>: {</span></span><span style=\"display:flex;\"><span>              <span style=\"color:#f92672\">&#34;order_id&#34;</span>: <span style=\"color:#e6db74\">&#34;0123456789&#34;</span>,</span></span><span style=\"display:flex;\"><span>              <span style=\"color:#f92672\">&#34;order_total&#34;</span>: <span style=\"color:#e6db74\">&#34;34.98&#34;</span></span></span><span style=\"display:flex;\"><span>            }</span></span><span style=\"display:flex;\"><span>          }</span></span><span style=\"display:flex;\"><span>        }</span></span><span style=\"display:flex;\"><span>      },</span></span><span style=\"display:flex;\"><span>    },</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;creation_ts&#34;</span>: <span style=\"color:#ae81ff\">1603373790000</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;total_event_count&#34;</span>: <span style=\"color:#ae81ff\">2</span>,</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#f92672\">&#34;events_compressed&#34;</span>: <span style=\"color:#66d9ef\">false</span></span></span><span style=\"display:flex;\"><span>}</span></span></code></pre></div><h2 id=\"authenticate-with-a-service-provider\">Authenticate with a service provider</h2><p>Functions require authentication to access some service providers, such as Facebook or Google. For more information, see <a href=\"/server-side/functions/event-visitor-functions/authentication/\">Adding an Authentication to a Function</a>. When you add an authentication, a unique token ID for the authorization token is returned.</p><p>When a function makes an HTTP request using the token ID, it is automatically replaced with the token before the request is sent. The following example shows how to use <code>helper.getAuth()</code> to get the token ID:</p><pre tabindex=\"0\"><code>activate(({ helper }) =&gt; {  console.log(helper.getAuth(&#34;TEST_AUTH&#34;));});</code></pre><p>For information on adding authentication for an event or visitor function, see <a href=\"/server-side/functions/event-visitor-functions/authentication/\">Adding an Authentication to a Function</a>.</p><h2 id=\"manage-global-variables\">Manage global variables</h2><p>You can create and store key/value pairs, referred to as global variables, that specify string variables or constants. These global variables can be used in multiple functions. Global variables can be added, edited, and deleted from the <strong>Code</strong> tab of the functions code editor. Functions can retrieve the value of a global variable, but cannot modify it.</p><p>For more information on adding and editing global variables, see <a href=\"/server-side/functions/manage-functions/manage-global-variables/\">Managing Functions</a>.</p><h3 id=\"get-a-global-variable-value\">Get a global variable value</h3><p>Functions that use the V3 runtime use <code>helper.getGlobalVariable()</code> to retrieve global variables, as follows:</p><pre tabindex=\"0\"><code>activate(({ helper }) =&gt; {  console.log(helper.getGlobalVariable(&#34;TEST_GLOBAL_VAR&#34;));});</code></pre><h2 id=\"get-an-attribute-name-or-attribute-value-by-attribute-id\">Get an attribute name or attribute value by attribute ID</h2><p>Attribute names can be changed, which can cause problems when code references attributes by name. To avoid problems with attribute names changing, you can reference attributes by ID. Event and visitor objects have a <code>getAttributeNameById()</code> method that you can use to get an attribute name based on its ID. You can also get the value of an attribute using the <code>getAttributeValueById()</code> method. The following example shows how this works.</p><p>If you enter the following in the code editor, when you enter the opening parenthesis, a list of attributes and associated IDs is displayed: <figure><a class=\"slb\" href=\"/images/server-side/functions-code-completion-attr-name.png\"><img src=\"https://docs.tealium.com/images/server-side/functions-code-completion-attr-name.png\"         alt=\"code completion attribute name\"         title=\"code completion attribute name\"/>    </a></figure></p><p>You can enter part of the attribute name to filter the list. When you select an attribute, its ID is added to your code after the parenthesis. The list of attributes works the same way for <code>getAttributeValueById()</code>.</p><h2 id=\"send-an-event-to-tealium-collect\">Send an event to Tealium Collect</h2><p>Event and visitor functions can create a new event based on the event or visitor object and send the event to Tealium Collect. The following example shows how to send an event to the Tealium Collect HTTP API:</p><pre tabindex=\"0\"><code>activate(({ event }) =&gt; {  if (event.data.udo.is_collect_candidate) {    const newEventPayload = { new_key: &#34;complex data derived from the event&#34; };    const config = {        tealium_account: &#39;newAccount&#39;,        tealium_profile: &#39;newProfile&#39;,        tealium_datasource: &#39;datasourceId&#39;    };        track(newEventPayload, config)        .then(response =&gt; {            if (!response.ok) {                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }                console.log(&#39;Status code:&#39;, response.status);            return response.text();        })        .then(data =&gt; console.log(&#39;Result:&#39;, data))        .catch(error =&gt; console.error(&#39;Error:&#39;, error.message));  }});</code></pre><h2 id=\"use-the-fetch-api-to-make-http-requests\">Use the fetch() API to make HTTP Requests</h2><p>The fetch API is available for functions to make HTTP requests, as shown in the following example. For more information, see <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/fetch\">Fetch</a>.</p><pre tabindex=\"0\"><code>activate(({ event }) =&gt; {  // The assumption is that event.data.udo.user_country is defined and matches the API  event.data.udo.user_country = &#34;usa&#34;;    fetch(`https://restcountries.eu/rest/v2/name/${event.data.udo.user_country}`)    .then(response =&gt; {      if (!response.ok) {        throw new Error(`Network response was not ok. Status code: ${response.status}.`);      }      return response.json();    })    .then(data =&gt; console.log(&#39;Capital:&#39;, data[0].capital))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));});</code></pre><p>The following example shows fetching a resource from the network, returning a promise that is fulfilled when the response is available.</p><pre tabindex=\"0\"><code>const fetchResponsePromise = fetch(resource [, init])</code></pre><p>The Request interface of the Fetch API represents a resource request and is defined as follows:</p><pre tabindex=\"0\"><code>const myRequest = new Request(input[, init]);</code></pre><p>Functions can use the Headers interface of the Fetch API to perform various actions on HTTP request and response headers. Headers() is defined as follows:</p><pre tabindex=\"0\"><code>const myHeaders = new Headers(init);</code></pre><p>The Response interface of the Fetch API represents the response to a request and is defined as follows:</p><pre tabindex=\"0\"><code>const myResponse = new Response(body, init);</code></pre><p>The following browser-specific functionality is not supported:</p><ul><li>cache</li><li>credentials</li><li>referrer</li><li>referrerPolicy</li><li>signal</li><li>keepalive</li><li>redirect</li><li>mode</li></ul><h2 id=\"use-urlsearchparams-methods-to-build-a-url-query-string\">Use URLSearchParams methods to build a URL query string</h2><p>The URLSearchParams interface defines utility methods to work with the query string of a URL. This example shows using URLSearchParams to build a query string for a URL.</p><pre tabindex=\"0\"><code>function jsonToURLSearchParams(data) {    const params = new URLSearchParams();    buildURLSearchParams(params, data);    return params;}function buildURLSearchParams(params, data, parentKey) {    if (data &amp;&amp; typeof data === &#39;object&#39; &amp;&amp; !(data instanceof Date)) {        Object.keys(data).forEach(key =&gt; {            buildURLSearchParams(params, data[key], parentKey ? `${parentKey}[${key}]` : key);        });    } else {        const value = data == null ? &#39;&#39; : data;        params.append(parentKey, value);    }}</code></pre>"
        }  

    , 
        {
            "weight": "40",
            "url": "https://docs.tealium.com/server-side/functions/event-visitor-functions/migrate-v2-to-v3/",
            "title": "Migrate a V2 function to the V3 runtime",
            "body":"<p>Event and visitor functions that use the V3 runtime differ from V2 functions as follows:</p><ul><li>Input data is provided as parameters instead of named exports.<ul><li>An event function has two parameters: <code>event</code> and <code>helper</code>.</li><li>A visitor function has three parameters: <code>visitor</code>, <code>visit</code>, and <code>helper</code>.</li></ul></li><li>The <code>helper</code> object is used to get an authentication token ID or retrieve global variables. <code>auth.get()</code> and <code>store.get()</code> have been replaced with <code>helper.getAuth()</code> and <code>helper.getGlobalVariable()</code>.</li><li><code>track()</code> is used to send events to Tealium Collect.</li></ul><h2 id=\"migrate-function-code\">Migrate function code</h2><p>To migrate a V2 function to the V3 runtime, follow these steps:</p><ol><li>Create a new function of the appropriate type (event or visitor).<br>For more information, see <a href=\"/server-side/functions/manage-functions/create-function/\">Create a function</a>.</li><li>Replace the default function code with an empty event or visitor function, as follows:<br><div class=\"code-tabs\">  <ul class=\"nav nav-tabs\"></ul>  <div class=\"tab-content\"><div class=\"tab-pane\" data-lang=\"Event function\" title=\"Event function\">  <div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">activate</span>(<span style=\"color:#66d9ef\">async</span> ({ <span style=\"color:#a6e22e\">event</span>, <span style=\"color:#a6e22e\">helper</span> }) =&gt; {  </span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span>});</span></span></code></pre></div></div><div class=\"tab-pane\" data-lang=\"Visitor function\" title=\"Visitor function\">  <div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">activate</span>(<span style=\"color:#66d9ef\">async</span> ({ <span style=\"color:#a6e22e\">visitor</span>, <span style=\"color:#a6e22e\">visit</span>, <span style=\"color:#a6e22e\">helper</span> }) =&gt; {  </span></span><span style=\"display:flex;\"><span></span></span><span style=\"display:flex;\"><span>});</span></span></code></pre></div></div></div></div></li><li>Copy the code from your V2 function that is between the opening and closing curly braces, { }, for the function. The import statements and the function declaration are not needed.</li><li>Paste the code into the new function.</li><li>If your V2 function used other libraries, such as CrytpoES, import them as before. For more information on importing libraries, see <a href=\"/server-side/functions/modules/\">APIs and libraries for functions</a>. For example:<br><code>import CryptoES from 'crypto-es';</code></li><li>If your V2 function used <code>auth.get()</code> or <code>store.get()</code> add <code>helper</code> to the function parameters. For example:<br><code>activate(async ({ event, helper }) =&gt; {</code></li><li>Replace any instances of <code>auth.get()</code> with <code>helper.getAuth()</code>.</li><li>Replace any instances of <code>store.get()</code> with <code>helper.getGlobalVariable()</code>.</li><li>If your V2 function used <code>tealium.sendCollectEvent()</code>, replace these calls with <code>track()</code> calls, as follows:<div class=\"highlight\"><pre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"><code class=\"language-js\" data-lang=\"js\"><span style=\"display:flex;\"><span><span style=\"color:#a6e22e\">activate</span>(({ <span style=\"color:#a6e22e\">event</span> }) =&gt; {</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#66d9ef\">const</span> <span style=\"color:#a6e22e\">newEvent</span> <span style=\"color:#f92672\">=</span> { <span style=\"color:#a6e22e\">data</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">event</span>.<span style=\"color:#a6e22e\">data</span>.<span style=\"color:#a6e22e\">udo</span> };</span></span><span style=\"display:flex;\"><span>    <span style=\"color:#a6e22e\">track</span>(<span style=\"color:#a6e22e\">newEvent</span>, {</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">tealium_account</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">event</span>.<span style=\"color:#a6e22e\">account</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">tealium_profile</span><span style=\"color:#f92672\">:</span> <span style=\"color:#a6e22e\">event</span>.<span style=\"color:#a6e22e\">profile</span>,</span></span><span style=\"display:flex;\"><span>        <span style=\"color:#a6e22e\">tealium_datasource</span><span style=\"color:#f92672\">:</span> <span style=\"color:#e6db74\">&#39;abc123&#39;</span></span></span><span style=\"display:flex;\"><span>    })</span></span><span style=\"display:flex;\"><span>})</span></span></code></pre></div></li></ol>"
        }  

    , 
        {
            "weight": "50",
            "url": "https://docs.tealium.com/server-side/functions/event-visitor-functions/function-examples-v2/",
            "title": "Event and visitor function examples (V2)",
            "body":"<h2 id=\"send-event-data-with-http-post\">Send event data with HTTP POST</h2><p>The following example shows how to make an HTTP POST request to an endpoint with event data in the request body JSON.</p><pre tabindex=\"0\"><code>// Send event data - HTTP POSTimport {event} from &#39;tealium&#39;;console.log(JSON.stringify(event));fetch(&#39;https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d&#39;,    {        method: &#39;POST&#39;,        body: JSON.stringify(event),        headers: {            &#39;Content-Type&#39;: &#39;application/json&#39;        }    })    .then(response =&gt; {        if (!response.ok) {            throw new Error(&#39;Network response was not ok. Status code: ${response.status}.&#39;);        }        return response.json();    })    .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h2 id=\"send-event-data-with-http-get\">Send event data with HTTP GET</h2><p>The following example shows how to make an HTTP GET request to an endpoint with event data as query string parameters.</p><pre tabindex=\"0\"><code>// Send event data - HTTP GETimport {event} from &#39;tealium&#39;;console.log(JSON.stringify(event));fetch(encodeURI(&#39;https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d?param=${event.data}&#39;))    .then(response =&gt; {        if (!response.ok) {            throw new Error(&#39;Network response was not ok. Status code: ${response.status}.&#39;);        }        return response.json();    })    .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h2 id=\"send-visitor-data-with-http-post\">Send visitor data with HTTP POST</h2><p>The following example shows how to make an HTTP POST request to an endpoint with visitor profile data in the request body JSON.</p><pre tabindex=\"0\"><code>// Send visitor data - HTTP POSTimport {visitor} from &#39;tealium&#39;;console.log(JSON.stringify(visitor));fetch(&#39;https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d&#39;,    {        method: &#39;POST&#39;,        body: JSON.stringify(visitor),         headers: {            &#39;Content-Type&#39;: &#39;application/json&#39;        }    })    .then(response =&gt; {        if (!response.ok) {            throw new Error(&#39;Network response was not ok. Status code: ${response.status}.&#39;);        }        return response.json();    })    .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h2 id=\"send-visitor-data-with-http-get\">Send visitor data with HTTP GET</h2><p>The following example shows how to make an HTTP GET request to an endpoint with visitor profile data as query string parameters.</p><pre tabindex=\"0\"><code>// Send visitor data - HTTP GETimport {visitor} from &#39;tealium&#39;;console.log(JSON.stringify(visitor));fetch(encodeURI(&#39;https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d?param=${visitor.data}&#39;))    .then(response =&gt; {        if (!response.ok) {            throw new Error(&#39;Network response was not ok. Status code: ${response.status}.&#39;);        }        return response.json();    })    .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h2 id=\"retrieve-visitor-data-and-send-it-to-tealium-collect\">Retrieve visitor data and send it to Tealium Collect</h2><p>In this example, the function uses the IP address to get the location city, gets weather information for that city, and sends the city and weather information to the Tealium Collect HTTP API.</p><pre tabindex=\"0\"><code>import { auth, visitor, event } from &#34;tealium&#34;;console.log(JSON.stringify(visitor));const ip_stack_api_key = &#39;your_api_key&#39;,      weather_api_key = &#39;your_weather_api_key&#39;,      ip_address = visitor?.current_visit?.properties?.ip_address;console.log(ip_address);(async function() {    if(ip_address) {    try {        // Use IP address to get location city        let city_response = await fetch(&#39;https://api.ipstack.com/${ip_address}?access_key=${ip_stack_api_key}&amp;format=1&#39;),        city_data = await city_response.json();        console.log(JSON.stringify(city_data));        // Use location city to get local weather        let weather_response = await fetch(encodeURI(&#39;https://api.openweathermap.org/data/2.5/weather?q=${city_data.city}&amp;appid=${weather_api_key}&#39;)),            weather_data = await weather_response.json();            console.log(JSON.stringify(weather_data));        // Send city and weather description back into collect endpoint        await fetch(encodeURI(&#39;https://collect.tealiumiq.com/event?tealium_account=cloud-functions-usecases&amp;tealium_profile=main&amp;tealium_visitor_id=${visitor._id}&amp;lookup_city=${weather_data?.name}&amp;weather=${weather_data?.weather?.[0]?.description}&amp;country=isp=${city_data?.connection?.isp}&#39;));    } catch(e) {        console.error(e);        return false;    }    } else {        console.error(&#34;Could not locate users IP address&#34;)    }})();</code></pre><h2 id=\"get-a-facebook-authentication-token\">Get a Facebook authentication token</h2><p>The following code example shows how to get a Facebook authentication token:</p><pre tabindex=\"0\"><code>import { auth } from &#39;tealium&#39;;const token = auth.get(&#39;facebook_token&#39;);fetch(&#39;https://graph.facebook.com/v8.0/act_12345678/customaudiences??access_token=${token}&amp;fields=approximate_count%2Csubtype%2Cname%2Cdata_source&amp;limit=10&#39;)  .then(response =&gt; response.json())  .then(data =&gt; console.log(&#39;Data:&#39;, data))  .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h3 id=\"send-data-to-facebook\">Send data to Facebook</h3><p>This example shows how to send event data to the Facebook Graph or Marketing API to create a campaign. For more information on Facebook campaigns, see <a href=\"https://developers.facebook.com/docs/marketing-api/reference/ad-campaign-group\">https://developers.facebook.com/docs/marketing-api/reference/ad-campaign-group).</a>.</p><pre tabindex=\"0\"><code>import {auth, event} from &#39;tealium&#39;;const ACT_ID = 11111111111;const ACCESS_TOKEN = auth.get(&#34;facebook_token&#34;);fetch(&#39;https://graph.facebook.com/v8.0/act_${ACT_ID}/campaigns?access_token=${ACCESS_TOKEN}&#39;,    {        method: &#39;POST&#39;,        body: &#39;name=${event.data}&amp;objective=PAGE_LIKES&amp;status=PAUSED&amp;special_ad_categories=[]&#39;    })    .then(response =&gt; {            if (!response.ok) {                throw new Error(&#39;Network response was not ok. Status code: ${response.status}.&#39;);            }            return response.json();        })    .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))    .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));</code></pre><h2 id=\"create-a-facebook-campaign\">Create a Facebook campaign</h2><p>This example shows how to create a Facebook campaign.</p><pre tabindex=\"0\"><code>import { auth } from &#34;tealium&#34;;const ACT_ID = 11111111111;const ACCESS_TOKEN = auth.get(&#34;facebook_token&#34;);(async function () {    console.time(&#39;function&#39;);    try {        console.log(&#39;Creating campaign...&#39;);        let campaignId = await createCampaign({ campaignName: &#39;My Campaign&#39; });        console.log(&#39;Campaign ID&#39;, campaignId);        console.log(&#39;Creating custom audience...&#39;);        let customAudienceId = await createCustomAudience({ caName: &#39;My_Audience&#39; });        console.log(&#39;Custom Audience ID&#39;, customAudienceId);        console.log(&#39;Creating ad set...&#39;);        customAudienceId = 23846304008770411;        let adSetId = await createAdSet({ campaignId: campaignId, customAudienceId: customAudienceId });        console.log(&#39;Ad Set ID&#39;, adSetId);        console.log(&#39;Creating ad creative...&#39;);        // let adCreativeId = await createAdCreative();        // current API call not working, use an ID created manually before        let adCreativeId = &#39;adCreativeId&#39;;        console.log(&#39;AdCreative ID &#39;, adCreativeId);        console.log(&#39;Creating ad...&#39;);        let adId = await createAd({ adsetId: adSetId, adCreativeId: adCreativeId });        console.log(&#39;Ad ID&#39;, adId);        console.timeEnd(&#39;function&#39;);    } catch (error) {        console.log(error);    }})();async function createAd({ adsetId, adCreativeId }) {    const params = {        &#39;status&#39;: &#39;PAUSED&#39;,        &#39;adset_id&#39;: adsetId,        &#39;name&#39;: &#39;My Ad&#39;,        &#39;creative&#39;: { &#39;creative_id&#39;: adCreativeId },    };    let result = await fetch(&#39;https://graph.facebook.com/v7.0/act_${ACT_ID}/ads?access_token=${ACCESS_TOKEN}&#39;,        {            method: &#39;POST&#39;,            body: jsonToRequestBodyString(params)        });    let json = await result.json();    return json.id;}async function createAdSet({ campaignId, customAudienceId }) {    const params = {        &#39;name&#39;: &#39;AdSet&#39;,        &#39;lifetime_budget&#39;: &#39;1000&#39;,        &#39;start_time&#39;: &#39;2020-07-01T23:41:41-0800&#39;,        &#39;end_time&#39;: &#39;2020-07-07T23:41:41-0800&#39;,        &#39;campaign_id&#39;: campaignId,        &#39;bid_amount&#39;: &#39;1&#39;,        &#39;billing_event&#39;: &#39;IMPRESSIONS&#39;,        &#39;optimization_goal&#39;: &#39;LINK_CLICKS&#39;,        &#39;targeting&#39;: {            &#34;geo_locations&#34;: {                &#34;countries&#34;: [&#34;US&#34;],            },            &#34;age_min&#34;: 25,            &#34;age_max&#34;: 40,            &#34;custom_audiences&#34;: [{ &#34;id&#34;: customAudienceId }]        },        &#39;status&#39;: &#39;PAUSED&#39;    };    let result = await fetch(&#39;https://graph.facebook.com/v7.0/act_${ACT_ID}/adsets?access_token=${ACCESS_TOKEN}&#39;,        {            method: &#39;POST&#39;,            body: jsonToRequestBodyString(params)        });    let json = await result.json();    return json.id;}async function createCustomAudience({ caName }) {    const params = {        &#39;name&#39;: caName,        &#39;subtype&#39;: &#39;CUSTOM&#39;,        &#39;description&#39;: &#39;People who purchased on my website&#39;,        &#39;customer_file_source&#39;: &#39;USER_PROVIDED_ONLY&#39;,    };    let result = await fetch(&#39;https://graph.facebook.com/v7.0/act_${ACT_ID}/customaudiences?access_token=${ACCESS_TOKEN}&#39;,        {            method: &#39;POST&#39;,            body: jsonToRequestBodyString(params)        });    let json = await result.json();    return json.id;}async function createCampaign({ campaignName }) {    const params = {        &#39;objective&#39;: &#39;LINK_CLICKS&#39;,        &#39;status&#39;: &#39;PAUSED&#39;,        &#39;buying_type&#39;: &#39;AUCTION&#39;,        &#39;name&#39;: campaignName,        &#39;special_ad_categories&#39;: &#39;NONE&#39;    };    let result = await fetch(&#39;https://graph.facebook.com/v8.0/act_${ACT_ID}/campaigns?access_token=${ACCESS_TOKEN}&#39;,        {            method: &#39;POST&#39;,            body: jsonToRequestBodyString(params)        });    let json = await result.json();    return json.id;}function jsonToRequestBodyString(json) {    return Object.keys(json).map(function (key) {        return encodeURIComponent(key) + &#39;=&#39; +            ((typeof json[key] === &#39;string&#39; || json[key] instanceof String) ? encodeURIComponent(json[key]) : JSON.stringify(json[key]));    }).join(&#39;&amp;&#39;);}</code></pre>"
        }  

    , 
        {
            "weight": "60",
            "url": "https://docs.tealium.com/server-side/functions/event-visitor-functions/v3-function-examples/",
            "title": "Event and visitor functions examples (V3)",
            "body":"<h2 id=\"send-event-data-with-http-get\">Send event data with HTTP GET</h2><p>The following example shows how to make an HTTP GET request to an endpoint with event data as query string parameters.</p><pre tabindex=\"0\"><code>activate(({ event }) =&gt; {    console.log(JSON.stringify(event));    fetch(encodeURI(`https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d?param=${event.data}`))        .then(response =&gt; {            if (!response.ok) {                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }            return response.json();        })        .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))        .catch(error =&gt; console.log(&#39;Error:&#39;, error.message)); })</code></pre><h2 id=\"send-visitor-data-with-http-post\">Send visitor data with HTTP POST</h2><p>The following example shows how to make an HTTP POST request to an endpoint with visitor profile data in the request body JSON.</p><pre tabindex=\"0\"><code>activate(({ visitor }) =&gt; {    console.log(JSON.stringify(visitor));    fetch(&#39;https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d&#39;,        {            method: &#39;POST&#39;,            body: JSON.stringify(visitor),             headers: {                &#39;Content-Type&#39;: &#39;application/json&#39;            }        })        .then(response =&gt; {            if (!response.ok) {                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }            return response.json();        })        .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))        .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));})</code></pre><h2 id=\"send-visitor-data-with-http-get\">Send visitor data with HTTP GET</h2><p>The following example shows how to make an HTTP GET request to an endpoint with visitor profile data as query string parameters.</p><pre tabindex=\"0\"><code>activate(({ visit }) =&gt; {    console.log(JSON.stringify(visit)); // notice separate visit property    fetch(encodeURI(`https://webhook.site/87bb160f-475a-4258-b117-693bb2378a4d?param=${visit.creation_ts}`))        .then(response =&gt; {            if (!response.ok) {                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }            return response.json();        })        .then(data =&gt; console.log(&#39;Response:&#39;, JSON.stringify(data)))        .catch(error =&gt; console.log(&#39;Error:&#39;, error.message));})</code></pre><h2 id=\"send-an-event-to-the-tealium-collect-http-api\">Send an event to the Tealium Collect HTTP API</h2><p>The following example shows how to fetch data and send an event to Tealium Collect.</p><pre tabindex=\"0\"><code>activate(async ({ event }) =&gt; {    const searchQuery = new URLSearchParams({ path: event.data.dom.pathname, query: event.data.dom.search_query });        const newEvent = await fetch(`https://getnew.event.com?${searchQuery}`)        .then(response =&gt; {            if (!response.ok) {                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }            return response.json();        });            track(newEvent, {            tealium_account: event.account,            tealium_profile: event.profile,            tealium_datasource: &#39;p9v81m&#39;        })        .then(response =&gt; {            if(!response.ok){                throw new Error(`Network response was not ok. Status code: ${response.status}.`);            }            return response.text();        })        .then(data =&gt; console.log(&#39;Result : &#39;, data))        .catch(error =&gt; console.error(&#39;Error:&#39;, error.message));})</code></pre><h2 id=\"get-an-authentication-token-id\">Get an authentication token ID</h2><p>The following code example shows how to get an authentication token ID:</p><pre tabindex=\"0\"><code>activate(({ helper }) =&gt; {    console.log(helper.getAuth(&#34;auth_token_name&#34;));})</code></pre><h2 id=\"get-the-value-of-a-global-variable\">Get the value of a global variable</h2><p>The following code example shows how to get the value of a global variable:</p><pre tabindex=\"0\"><code>activate(({ helper }) =&gt; {    console.log(helper.getGlobalVariable(&#34;global_variable_name&#34;));})</code></pre>"
        }  

    ]
}
